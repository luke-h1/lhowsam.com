"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9027],{87045:function(e,t,n){n.d(t,{L9:function(){return tZ},YH:function(){return t1},_F:function(){return em},iV:function(){return ne},q$:function(){return t3}});var i=n(58252),r=n(72470);n(54556);var l=n(30719),o=n(51341),s=n(52925),a=n(46227),c=n(73963),h=n(83741),d=n(80746),p=n(44730),u=n(62409),f=n(97932),g=n(43617),y=n(16326),m=n(99269),k=n(53663),b=n(79067),v=n(65912),x=n(7080),_=n(256),N=n(42125),w=n(68334),T=n(44820),S=n(18434),E=n(86900),M=n(9874),A=n(50058),R=n(84869),L=n(60970);function C(e){return e.selection?.anchor.path.join()===e.selection?.focus.path.join()&&e.selection?.anchor.offset===e.selection?.focus.offset}function B(e){let t=e.selection&&(0,i.Fd)(e.selection.focus.path[0])?e.selection.focus.path[0]._key:void 0,n=t?e.value.find(e=>e._key===t):void 0;return n&&t?{node:n,path:[{_key:t}]}:void 0}function D(e){let t=B(e);return t&&(0,i.DG)(t.node)?{node:t.node,path:t.path}:void 0}function $(e){let t=function(e){let t=D(e);if(!t)return;let n=e.selection&&(0,i.Fd)(e.selection.focus.path[2])?e.selection.focus.path[2]._key:void 0,r=n?t.node.children.find(e=>e._key===n):void 0;return r&&n?{node:r,path:[...t.path,"children",{_key:n}]}:void 0}(e);return t&&(0,i.NG)(t.node)?{node:t.node,path:t.path}:void 0}function P(e){return 1===e.children.length&&""===e.children[0].text}let I=[{on:"insert soft break",actions:[()=>[{type:"insert text",text:`
`}]]},{on:"insert break",guard:({context:e})=>!!function(e){let t=B(e);return t&&!(0,i.DG)(t.node)?{node:t.node,path:t.path}:void 0}(e),actions:[()=>[{type:"insert text block",decorators:[]}]]},{on:"delete backward",guard:({context:e})=>{let t=D(e),n=C(e),r=function(e){let t;let n=function(e){let t=e.selection.backward?(0,i.Fd)(e.selection.focus.path[0])?e.selection.focus.path[0]._key:void 0:(0,i.Fd)(e.selection.anchor.path[0])?e.selection.anchor.path[0]._key:void 0,n=t?e.value.find(e=>e._key===t):void 0;return n&&t?{node:n,path:[{_key:t}]}:void 0}(e);if(!n)return;let r=!1;for(let i of e.value){if(i._key===n.node._key){r=!0;break}t={node:i,path:[{_key:i._key}]}}if(r&&t)return t}(e);return!!t&&!!n&&!!r&&!!P(t.node)&&!(0,i.DG)(r.node)&&{focusTextBlock:t,previousBlock:r}},actions:[(e,{focusTextBlock:t,previousBlock:n})=>[{type:"delete",selection:{anchor:{path:t.path,offset:0},focus:{path:t.path,offset:0}}},{type:"select",selection:{anchor:{path:n.path,offset:0},focus:{path:n.path,offset:0}}}]]},{on:"delete forward",guard:({context:e})=>{let t=D(e),n=C(e),r=function(e){let t;let n=function(e){let t=e.selection.backward?(0,i.Fd)(e.selection.anchor.path[0])?e.selection.anchor.path[0]._key:void 0:(0,i.Fd)(e.selection.focus.path[0])?e.selection.focus.path[0]._key:void 0,n=t?e.value.find(e=>e._key===t):void 0;return n&&t?{node:n,path:[{_key:t}]}:void 0}(e);if(!n)return;let r=!1;for(let i of e.value){if(i._key===n.node._key){r=!0;continue}if(r){t={node:i,path:[{_key:i._key}]};break}}if(r&&t)return t}(e);return!!t&&!!n&&!!r&&!!P(t.node)&&!(0,i.DG)(r.node)&&{focusTextBlock:t,nextBlock:r}},actions:[(e,{focusTextBlock:t,nextBlock:n})=>[{type:"delete",selection:{anchor:{path:t.path,offset:0},focus:{path:t.path,offset:0}}},{type:"select",selection:{anchor:{path:n.path,offset:0},focus:{path:n.path,offset:0}}}]]},{on:"delete backward",guard:({context:e})=>{let t=C(e),n=D(e),i=$(e);return!!t&&!!n&&!!i&&n.node.children[0]._key===i.node._key&&0===e.selection.focus.offset&&1===n.node.level&&{focusTextBlock:n}},actions:[(e,{focusTextBlock:t})=>[{type:"unset block",props:["listItem","level"],paths:[t.path]}]]},{on:"delete backward",guard:({context:e})=>{let t=C(e),n=D(e),i=$(e);return!!t&&!!n&&!!i&&n.node.children[0]._key===i.node._key&&0===e.selection.focus.offset&&void 0!==n.node.level&&n.node.level>1&&{focusTextBlock:n,level:n.node.level-1}},actions:[(e,{focusTextBlock:t,level:n})=>[{type:"set block",level:n,paths:[t.path]}]]}];function Y(e){if(!e)throw Error("Parameter 'portabletextType' missing (required)");let t=e.of?.find(function e(t){return t.type?e(t.type):"block"===t.name?t:null});if(!t)throw Error("Block type is not defined in this schema (required)");let n=t.fields?.find(e=>"children"===e.name);if(!n)throw Error("Children field for block type found in schema (required)");let i=n.type.of;if(!i)throw Error("Valid types for block children not found in schema (required)");let r=i.find(e=>"span"===e.name);if(!r)throw Error("Span type not found in schema (required)");let l=i.filter(e=>"span"!==e.name)||[],o=e.of?.filter(e=>e.name!==t.name)||[];return{styles:function(e){let t=e.fields?.find(e=>"style"===e.name);if(!t)throw Error("A field with name 'style' is not defined in the block type (required).");let n=t.type.options?.list&&t.type.options.list?.filter(e=>e.value);if(!n||0===n.length)throw Error("The style fields need at least one style defined. I.e: {title: 'Normal', value: 'normal'}.");return n}(t),decorators:r.decorators,lists:function(e){let t=e.fields?.find(e=>"listItem"===e.name);if(!t)throw Error("A field with name 'listItem' is not defined in the block type (required).");let n=t.type.options?.list&&t.type.options.list.filter(e=>e.value);if(!n)throw Error("The list field need at least to be an empty array");return n}(t),block:t,span:r,portableText:e,inlineObjects:l,blockObjects:o,annotations:r.annotations}}let j="sanity-pte:";function O(e){let t=`${j}${e}`;return d&&d.enabled(t)?d(t):d(j)}function z(e,t,n){let i;let r=[e.path[0]];if(!t)return null;let l=t[r[0]];if(!l)return null;let o=[{_key:l._key}];if(l._type!==n.block.name)return o;let s=e.path.slice(0,2),a=Array.isArray(l.children)&&l.children[s[1]];return a&&(i=["children",{_key:a._key}]),i?[...o,...i]:o}function F(e,t){if(!t)return[];let[n,r]=Array.from(c.ML.nodes(t,{at:[],match:t=>(0,i.Fd)(e.path[0])&&t._key===e.path[0]._key}))[0]||[void 0,void 0];if(!n||!c.W_.isElement(n))return[];if(t.isVoid(n))return[r[0],0];let l=[e.path[2]],s=n.children.findIndex(e=>o([{_key:e._key}],l));if(s>=0&&n.children[s]){let e=n.children[s];return c.W_.isElement(e)&&t.isVoid(e)?r.concat(s).concat(0):r.concat(s)}return r}function W(e,t,n){if(!t)return null;let i=null,r=null,l=t.anchor&&z(t.anchor,e,n);l&&t.anchor&&(i={path:l,offset:t.anchor.offset});let o=t.focus&&z(t.focus,e,n);o&&t.focus&&(r={path:o,offset:t.focus.offset});let s=!!(c.e6.isRange(t)&&c.e6.isBackward(t));return i&&r?{anchor:i,focus:r,backward:s}:null}function G(e,t){if(!e||!t)return null;let n={path:F(e.anchor,t),offset:e.anchor.offset},i={path:F(e.focus,t),offset:e.focus.offset};return 0===i.path.length||0===n.path.length?null:n&&i?{anchor:n,focus:i}:null}function J(e,t){if(!e||!t)return null;let n=[],i=e.offset||0,r="object"==typeof e.path[0]&&"_key"in e.path[0]&&e.path[0]._key,l="object"==typeof e.path[2]&&"_key"in e.path[2]&&e.path[2]._key,o=t.find(e=>e._key===r);if(!o)return null;if(n.push({_key:o._key}),o&&"children"===e.path[1]){if(!o.children||Array.isArray(o.children)&&0===o.children.length)return null;let t=Array.isArray(o.children)&&o.children.find(e=>e._key===l);if(!t)return null;n.push("children"),n.push({_key:t._key}),i=t.text&&t.text.length>=e.offset?e.offset:t.text&&t.text.length||0}return{path:n,offset:i}}d(j);let V="void-child";function H(e,t){let n=t[e._key];return n&&o(e,n)?n:(t[e._key]=e,e)}function U(e,{schemaTypes:t},n={}){return e&&Array.isArray(e)?e.map(e=>{let{_type:i,_key:r,...l}=e,o=[{_key:V,_type:"span",text:"",marks:[]}];if(e&&e._type===t.block.name){let s=!1,a=typeof e.style>"u",h=typeof e.markDefs>"u",d=typeof e.children>"u",p=(e.children||[]).map(e=>{let{_type:t,_key:i,...r}=e;return"span"!==t?(s=!0,H({_type:t,_key:i,children:o,value:r,__inline:!0},n)):e});return!(!a&&!h&&!d&&!s&&c.W_.isElement(e))?(a&&(l.style=t.styles[0].value),H({_type:i,_key:r,...l,children:p},n)):e}return H({_type:i,_key:r,children:o,value:l},n)}):[]}function q(e,t,n={}){return e.map(e=>{let{_key:i,_type:r}=e;if(!i||!r)throw Error("Not a valid block");if(r===t&&"children"in e&&Array.isArray(e.children)&&i){let t=!1,l=e.children.map(e=>{let{_type:i}=e;if("value"in e&&"span"!==i){t=!0;let{value:i,_key:r,_type:l,__inline:o,children:s,...a}=e;return H({...a,...i,_key:r,_type:l},n)}return e});return t?H({...e,children:l,_key:i,_type:r},n):e}let l="value"in e&&e.value;return H({_key:i,_type:r,..."object"==typeof l?l:{}},n)})}function K(e,t){return void 0===e||e&&Array.isArray(e)&&0===e.length||e&&Array.isArray(e)&&1===e.length&&c.W_.isElement(e[0])&&e[0]._type===t.block.name&&"style"in e[0]&&e[0].style===t.styles[0].value&&!("listItem"in e[0])&&Array.isArray(e[0].children)&&1===e[0].children.length&&c.xv.isText(e[0].children[0])&&"span"===e[0].children[0]._type&&!e[0].children[0].marks?.join("")&&""===e[0].children[0].text}let Z=new WeakMap,X=new WeakMap,Q=new WeakMap,ee=new WeakMap,et=new WeakMap,en=new WeakMap,ei=new WeakMap,er=new WeakMap,el=new WeakMap,eo=e=>{let t,n;let i=(0,p.c)(4);return i[0]!==e.value?(t=JSON.stringify(e.value,null,2),i[0]=e.value,i[1]=t):t=i[1],i[2]!==t?(n=(0,l.jsx)("div",{children:(0,l.jsx)("pre",{children:t})}),i[2]=t,i[3]=n):n=i[3],n};eo.displayName="DefaultObject";let es=u.zo.div`
  user-select: none;
  border: ${e=>e.selected?"1px solid blue":"1px solid transparent"};
`;u.zo.span`
  background: #999;
  border: ${e=>e.selected?"1px solid blue":"1px solid transparent"};
`;let ea=u.zo.div`
  &.pt-list-item {
    width: fit-content;
    position: relative;
    display: block;

    /* Important 'transform' in order to force refresh the ::before and ::after rules
      in Webkit: https://stackoverflow.com/a/21947628/831480
    */
    transform: translateZ(0);
    margin-left: ${e=>(function(e){switch(Number(e)){case 1:return"1.5em";case 2:return"3em";case 3:return"4.5em";case 4:return"6em";case 5:return"7.5em";case 6:return"9em";case 7:return"10.5em";case 8:return"12em";case 9:return"13.5em";case 10:return"15em";default:return"0em"}})(e.listLevel)};
  }
  &.pt-list-item > .pt-list-item-inner {
    display: flex;
    margin: 0;
    padding: 0;
    &:before {
      justify-content: flex-start;
      vertical-align: top;
    }
  }
  &.pt-list-item-bullet > .pt-list-item-inner:before {
      content: '${e=>{var t;return t=e.listLevel,"bullet"===e.listStyle?eh[(t-1)%3]:"*"}}';
      font-size: 0.4375rem; /* 7px */
      line-height: 1.5rem; /* Same as body text */
      /* Optical alignment */
      position: relative;
    }
  }
  &.pt-list-item-bullet > .pt-list-item-inner {
    &:before {
      min-width: 1.5rem; /* Make sure space between bullet and text never shrinks */
    }
  }
  &.pt-list-item-number {
    counter-increment: ${e=>(function(e){switch(e){case 1:return"listItemNumber";case 2:return"listItemAlpha";case 3:return"listItemRoman";case 4:return"listItemNumberNext";case 5:return"listItemLetterNext";case 6:return"listItemRomanNext";case 7:return"listItemNumberNextNext";case 8:return"listItemAlphaNextNext";case 9:return"listItemRomanNextNext";default:return"listItemNumberNextNextNext"}})(e.listLevel)};
    counter-reset: ${e=>(function(e){switch(e){case 1:return"listItemAlpha";case 2:return"listItemRoman";case 3:return"listItemNumberNext";case 4:return"listItemLetterNext";case 5:return"listItemRomanNext";case 6:return"listItemNumberNextNext";case 7:return"listItemAlphaNextNext";case 8:return"listItemRomanNextNext";default:return"listItemNumberNextNextNext"}})(e.listLevel)};
  }
  & + :not(.pt-list-item-number) {
    counter-reset: listItemNumber;
  }
  &.pt-list-item-number > .pt-list-item-inner:before {
    content: ${e=>(function(e){switch(e){case 1:return"counter(listItemNumber) '. '";case 2:return"counter(listItemAlpha, lower-alpha) '. '";case 3:return"counter(listItemRoman, lower-roman) '. '";case 4:return"counter(listItemNumberNext) '. '";case 5:return"counter(listItemLetterNext, lower-alpha) '. '";case 6:return"counter(listItemRomanNext, lower-roman) '. '";case 7:return"counter(listItemNumberNextNext) '. '";case 8:return"counter(listItemAlphaNextNext, lower-alpha) '. '";case 9:return"counter(listItemRomanNextNext, lower-roman) '. '";default:return"counter(listItemNumberNextNextNext) '. '"}})(e.listLevel)};
    min-width: 1.5rem; /* Make sure space between number and text never shrinks */
    /* Optical alignment */
    position: relative;
    top: 1px;
  }
`,ec=u.zo.div``,eh=["●","○","■"],ed=O("components:DraggableBlock"),ep=e=>{let t,n,i,r,o,s,d,u,f,g,y,m,k,b,v,x,_;let N=(0,p.c)(51),{children:w,element:T,readOnly:S,blockRef:E}=e,M=(0,h._7)(),A=(0,a.useRef)(),[R,L]=(0,a.useState)(!1);N[0]!==M||N[1]!==T?(n=c.ML.isVoid(M,T),N[0]=M,N[1]=T,N[2]=n):n=N[2],t=n,N[3]!==M||N[4]!==T?(r=c.ML.isInline(M,T),N[3]=M,N[4]=T,N[5]=r):r=N[5],i=r;let[C,B]=(0,a.useState)(null);N[6]!==E||N[7]!==M||N[8]!==T?(o=()=>B(E?E.current:h.F3.toDOMNode(M,T)),s=[M,T,E],N[6]=E,N[7]=M,N[8]=T,N[9]=o,N[10]=s):(o=N[9],s=N[10]),(0,a.useEffect)(o,s),N[11]!==M||N[12]!==C||N[13]!==T?(d=e=>{let t=ee.get(M);if(!t||!C)return;e.preventDefault(),e.dataTransfer.dropEffect="move",et.set(M,T);let n=C.getBoundingClientRect(),i=n.top,r=n.height,l=e.pageY;if(T===M.children[0]||(Math.abs(i-l)<r/2?en.set(M,"top"):en.set(M,"bottom")),t===T){e.dataTransfer.dropEffect="none";return}L(!0)},N[11]=M,N[12]=C,N[13]=T,N[14]=d):d=N[14];let D=d;N[15]===Symbol.for("react.memo_cache_sentinel")?(u=()=>{L(!1)},N[15]=u):u=N[15];let $=u;N[16]!==M||N[17]!==T?(f=e=>{let t=et.get(M);if(t){Q.set(M,!1),e.preventDefault(),e.stopPropagation(),et.delete(M),A.current&&(ed("Removing drag ghost"),document.body.removeChild(A.current));let n=en.get(M);en.delete(M);let i=h.F3.findPath(M,t),r=h.F3.findPath(M,T),l=c.y$.isBefore(r,i);if("bottom"===n&&!l){if(i[0]>=M.children.length-1){ed("target is already at the bottom, not moving");return}let e=i;i=c.y$.next(i),ed(`Adjusting targetPath from ${JSON.stringify(e)} to ${JSON.stringify(i)}`)}if("top"===n&&l&&i[0]!==M.children.length-1){let e=i;i=c.y$.previous(i),ed(`Adjusting targetPath from ${JSON.stringify(e)} to ${JSON.stringify(i)}`)}if(c.y$.equals(i,r)){e.preventDefault(),ed("targetPath and myPath is the same, not moving");return}ed(`Moving element ${T._key} from path ${JSON.stringify(r)} to ${JSON.stringify(i)} (${n})`),c.YR.moveNodes(M,{at:r,to:i}),M.onChange();return}ed("No target element, not doing anything")},N[16]=M,N[17]=T,N[18]=f):f=N[18];let P=f;N[19]!==M||N[20]!==T?(g=e=>{ee.get(M)&&(ed("On drop (prevented)",T),e.preventDefault(),e.stopPropagation(),L(!1))},N[19]=M,N[20]=T,N[21]=g):g=N[21];let I=g;N[22]!==t||N[23]!==M||N[24]!==T?(y=e=>{if(!t){ee.delete(M);return}Q.set(M,!0),ee.set(M,T),e.stopPropagation();let n=e.target;n instanceof HTMLElement&&(n.style.opacity="1")},N[22]=t,N[23]=M,N[24]=T,N[25]=y):y=N[25];let Y=y;N[26]!==t||N[27]!==i||N[28]!==M||N[29]!==C||N[30]!==Y?(m=e=>{if(!t||i){ed("Not dragging block"),ee.delete(M),Q.set(M,!1);return}if(ed("Drag start"),Q.set(M,!0),e.dataTransfer&&(e.dataTransfer.setData("application/portable-text","something"),e.dataTransfer.effectAllowed="move"),C&&C instanceof HTMLElement){let t=C.cloneNode(!0),n=t.querySelector("[data-pt-drag-ghost-element]");if(n&&(t=n),t.setAttribute("data-dragged",""),document.body){A.current=t,t.style.position="absolute",t.style.left="-99999px",t.style.boxSizing="border-box",document.body.appendChild(t);let n=C.getBoundingClientRect(),i=e.clientX-n.left,r=e.clientY-n.top;t.style.width=`${n.width}px`,t.style.height=`${n.height}px`,e.dataTransfer.setDragImage(t,i,r)}}Y(e)},N[26]=t,N[27]=i,N[28]=M,N[29]=C,N[30]=Y,N[31]=m):m=N[31];let j=m;N[32]!==R||N[33]!==M?(k=R&&M.children[0]===et.get(M),N[32]=R,N[33]=M,N[34]=k):k=N[34];let O=k;N[35]!==R||N[36]!==M?(b=R&&M.children[M.children.length-1]===et.get(M),N[35]=R,N[36]=M,N[37]=b):b=N[37];let z=b,F=en.get(M),W=O||R&&!O&&!z&&"top"===F,G=z||R&&!O&&!z&&"bottom"===F;if(N[38]===Symbol.for("react.memo_cache_sentinel")?(x=(0,l.jsx)("div",{className:"pt-drop-indicator",style:{position:"absolute",width:"100%",height:1,borderBottom:"1px solid currentColor",zIndex:5}}),N[38]=x):x=N[38],v=x,S){let e;return N[39]!==w?(e=(0,l.jsx)(l.Fragment,{children:w}),N[39]=w,N[40]=e):e=N[40],e}let J=W&&v,V=G&&v;return N[41]!==t||N[42]!==j||N[43]!==Y||N[44]!==D||N[45]!==P||N[46]!==I||N[47]!==J||N[48]!==w||N[49]!==V?(_=(0,l.jsxs)("div",{draggable:t,onDragStart:j,onDrag:Y,onDragOver:D,onDragLeave:$,onDragEnd:P,onDrop:I,children:[J,w,V]}),N[41]=t,N[42]=j,N[43]=Y,N[44]=D,N[45]=P,N[46]=I,N[47]=J,N[48]=w,N[49]=V,N[50]=_):_=N[50],_};ep.displayName="DraggableBlock",O("components:Element");let eu=[],ef={display:"inline-block"},eg=({attributes:e,children:t,element:n,schemaTypes:i,readOnly:r,renderBlock:o,renderChild:s,renderListItem:d,renderStyle:p,spellCheck:u})=>{let f;let g=(0,h._7)(),y=(0,h.vt)(),m=(0,a.useRef)(null),k=(0,a.useRef)(null),b=y&&g.selection&&c.e6.isCollapsed(g.selection)||!1,v=(0,a.useMemo)(()=>q([n],i.block.name,er.get(g))[0],[g,n,i.block.name]),x=t,_,N=(0,a.useMemo)(()=>[{_key:n._key}],[n]);if("string"!=typeof n._type)throw Error("Expected element to have a _type property");if("string"!=typeof n._key)throw Error("Expected element to have a _key property");if(g.isInline(n)){let o=h.F3.findPath(g,n),[a]=c.ML.node(g,o,{depth:1}),d=i.inlineObjects.find(e=>e.name===n._type);if(!d)throw Error("Could not find type for inline block element");if(c.W_.isElement(a)){let i=[{_key:a._key},"children",{_key:n._key}];return(0,l.jsxs)("span",{...e,children:[t,(0,l.jsxs)("span",{draggable:!r,className:"pt-inline-object","data-testid":"pt-inline-object",ref:k,style:ef,contentEditable:!1,children:[s&&s({annotations:eu,children:(0,l.jsx)(eo,{value:v}),editorElementRef:k,focused:b,path:i,schemaType:d,selected:y,type:d,value:v}),!s&&(0,l.jsx)(eo,{value:v})]},n._key)]})}throw Error("Block not found!")}if(n._type===i.block.name){let s;_="pt-block pt-text-block";let a="listItem"in n,c="style"in n&&n.style||"normal";_=`pt-block pt-text-block pt-text-block-style-${c}`;let h=i.styles.find(e=>e.value===c);if(p&&h&&(x=p({block:n,children:t,focused:b,selected:y,value:c,path:N,schemaType:h,editorElementRef:m})),a&&("number"==typeof n.level&&(s=n.level),_+=` pt-list-item pt-list-item-${n.listItem} pt-list-item-level-${s||1}`),g.isListBlock(v)&&a&&n.listItem){let e=i.lists.find(e=>e.value===n.listItem);x=d&&e?d({block:v,children:x,focused:b,selected:y,value:n.listItem,path:N,schemaType:e,level:v.level||1,editorElementRef:m}):(0,l.jsx)(ea,{listStyle:v.listItem||i.lists[0].value,listLevel:v.level||1,children:(0,l.jsx)(ec,{children:x})})}let f=Object.defineProperty({children:x,editorElementRef:m,focused:b,level:s,listItem:a?n.listItem:void 0,path:N,selected:y,style:c,schemaType:i.block,value:v},"type",{enumerable:!1,get:()=>(console.warn("Property 'type' is deprecated, use 'schemaType' instead."),i.block)}),k=o?o(f):t;return(0,l.jsx)("div",{...e,className:_,spellCheck:u,children:(0,l.jsx)(ep,{element:n,readOnly:r,blockRef:m,children:(0,l.jsx)("div",{ref:m,children:k})})},n._key)}let w=i.blockObjects.find(e=>e.name===n._type);if(!w)throw Error(`Could not find schema type for block element of _type ${n._type}`);_="pt-block pt-object-block";let T=q([n],i.block.name,er.get(g))[0];return o&&(f=o(Object.defineProperty({children:(0,l.jsx)(eo,{value:v}),editorElementRef:m,focused:b,path:N,schemaType:w,selected:y,value:T},"type",{enumerable:!1,get:()=>(console.warn("Property 'type' is deprecated, use 'schemaType' instead."),w)}))),(0,l.jsxs)("div",{...e,className:_,children:[t,(0,l.jsxs)(ep,{element:n,readOnly:r,blockRef:m,children:[f&&(0,l.jsx)("div",{ref:m,contentEditable:!1,children:f}),!f&&(0,l.jsx)(es,{selected:y,children:(0,l.jsx)(eo,{value:v})})]})]},n._key)};eg.displayName="Element";let ey=(0,a.createContext)(null),em=()=>{let e=(0,a.useContext)(ey);if(!e)throw Error("The `usePortableTextEditor` hook must be used inside the <PortableTextEditor> component's context.");return e};function ek(e){let t,n,i;let r=(0,p.c)(6);r[0]!==e.annotation?(t=()=>alert(JSON.stringify(e.annotation)),r[0]=e.annotation,r[1]=t):t=r[1];let o=t;return r[2]===Symbol.for("react.memo_cache_sentinel")?(n={color:"blue"},r[2]=n):n=r[2],r[3]!==o||r[4]!==e.children?(i=(0,l.jsx)("span",{style:n,onClick:o,children:e.children}),r[3]=o,r[4]=e.children,r[5]=i):i=r[5],i}function eb(e){return r.V.compile({name:"blockTypeSchema",types:[e]}).get(e.name)}ek.displayName="DefaultAnnotation";let ev=O("operationToPatches"),ex=O("API:editable");function e_(e,t){let n=eN(e)||!1;Z.set(e,!0),t(),Z.set(e,n)}function eN(e){return Z.get(e)}let ew=new WeakMap,eT=new WeakMap;function eS(e){return ew.get(e)??!1}function eE(e){return eT.get(e)??!1}function eM(e){let[t,n]=e;return[t,n]}function eA(e,t){let n=e,i=t,r=n.length,l=i.length;if(0===r||0===l)return 0;r>l?n=n.substring(r-l):r<l&&(i=i.substring(0,r));let o=Math.min(r,l);if(n===i)return o;let s=0,a=1;for(let e=0;-1!==e;){let t=n.substring(o-a);if(-1===(e=i.indexOf(t)))break;a+=e,(0===e||n.substring(o-a)===i.substring(0,a))&&(s=a,a++)}return s}function eR(e,t){if(!e||!t||e[0]!==t[0])return 0;let n=0,i=Math.min(e.length,t.length),r=i,l=0;for(;n<r;)e.substring(l,r)===t.substring(l,r)?l=n=r:i=r,r=Math.floor((i-n)/2+n);return r}function eL(e,t){if(!e||!t||e[e.length-1]!==t[t.length-1])return 0;let n=0,i=Math.min(e.length,t.length),r=i,l=0;for(;n<r;)e.substring(e.length-r,e.length-l)===t.substring(t.length-r,t.length-l)?l=n=r:i=r,r=Math.floor((i-n)/2+n);return r}let eC=/[^a-zA-Z0-9]/,eB=/\s/,eD=/[\r\n]/,e$=/\n\r?\n$/,eP=/^\r?\n\r?\n/;function eI(e){let t=e.map(e=>eM(e));function n(e,t){if(!e||!t)return 6;let n=e.charAt(e.length-1),i=t.charAt(0),r=n.match(eC),l=i.match(eC),o=r&&n.match(eB),s=l&&i.match(eB),a=o&&n.match(eD),c=s&&i.match(eD),h=a&&e.match(e$),d=c&&t.match(eP);return h||d?5:a||c?4:r&&!o&&s?3:o||s?2:r||l?1:0}let i=1;for(;i<t.length-1;){if(t[i-1][0]===eW&&t[i+1][0]===eW){let e=t[i-1][1],r=t[i][1],l=t[i+1][1],o=eL(e,r);if(o){let t=r.substring(r.length-o);e=e.substring(0,e.length-o),r=t+r.substring(0,r.length-o),l=t+l}let s=e,a=r,c=l,h=n(e,r)+n(r,l);for(;r.charAt(0)===l.charAt(0);){e+=r.charAt(0),r=r.substring(1)+l.charAt(0),l=l.substring(1);let t=n(e,r)+n(r,l);t>=h&&(h=t,s=e,a=r,c=l)}t[i-1][1]!==s&&(s?t[i-1][1]=s:(t.splice(i-1,1),i--),t[i][1]=a,c?t[i+1][1]=c:(t.splice(i+1,1),i--))}i++}return t}function eY(e){let t=e.map(e=>eM(e));t.push([eW,""]);let n=0,i=0,r=0,l="",o="",s;for(;n<t.length;)switch(t[n][0]){case eF:r++,o+=t[n][1],n++;break;case ez:i++,l+=t[n][1],n++;break;case eW:i+r>1?(0!==i&&0!==r&&(0!==(s=eR(o,l))&&(n-i-r>0&&t[n-i-r-1][0]===eW?t[n-i-r-1][1]+=o.substring(0,s):(t.splice(0,0,[eW,o.substring(0,s)]),n++),o=o.substring(s),l=l.substring(s)),0!==(s=eL(o,l))&&(t[n][1]=o.substring(o.length-s)+t[n][1],o=o.substring(0,o.length-s),l=l.substring(0,l.length-s))),n-=i+r,t.splice(n,i+r),l.length&&(t.splice(n,0,[ez,l]),n++),o.length&&(t.splice(n,0,[eF,o]),n++),n++):0!==n&&t[n-1][0]===eW?(t[n-1][1]+=t[n][1],t.splice(n,1)):n++,r=0,i=0,l="",o="";break;default:throw Error("Unknown diff operation")}""===t[t.length-1][1]&&t.pop();let a=!1;for(n=1;n<t.length-1;)t[n-1][0]===eW&&t[n+1][0]===eW&&(t[n][1].substring(t[n][1].length-t[n-1][1].length)===t[n-1][1]?(t[n][1]=t[n-1][1]+t[n][1].substring(0,t[n][1].length-t[n-1][1].length),t[n+1][1]=t[n-1][1]+t[n+1][1],t.splice(n-1,1),a=!0):t[n][1].substring(0,t[n+1][1].length)===t[n+1][1]&&(t[n-1][1]+=t[n+1][1],t[n][1]=t[n][1].substring(t[n+1][1].length)+t[n+1][1],t.splice(n+1,1),a=!0)),n++;return a&&(t=eY(t)),t}function ej(e,t,n,i,r){let l=e.substring(0,n),o=t.substring(0,i),s=e.substring(n),a=t.substring(i),c=eJ(l,o,{checkLines:!1,deadline:r}),h=eJ(s,a,{checkLines:!1,deadline:r});return c.concat(h)}function eO(e,t,n){let i=e.slice(n,n+Math.floor(e.length/4)),r=-1,l="",o,s,a,c;for(;-1!==(r=t.indexOf(i,r+1));){let i=eR(e.slice(n),t.slice(r)),h=eL(e.slice(0,n),t.slice(0,r));l.length<h+i&&(l=t.slice(r-h,r)+t.slice(r,r+i),o=e.slice(0,n-h),s=e.slice(n+i),a=t.slice(0,r-h),c=t.slice(r+i))}return 2*l.length>=e.length?[o||"",s||"",a||"",c||"",l||""]:null}let ez=-1,eF=1,eW=0;function eG(e,t,n){var i,r;let l;if(null===e||null===t)throw Error("Null input. (diff)");let o=eJ(e,t,{checkLines:!0,deadline:(r=(i=n||{}).timeout||1,l=1,"u">typeof r&&(l=r<=0?Number.MAX_VALUE:r),Date.now()+1e3*l),...i});return function(e){for(let t=0;t<e.length;t++){let[n,i]=e[t];if(0===i.length)continue;let r=i[0];(function(e){let t=e.charCodeAt(0);return t>=55296&&t<=56319})(i[i.length-1])&&n===eW&&eU(e,t,1),function(e){let t=e.charCodeAt(0);return t>=56320&&t<=57343}(r)&&n===eW&&eU(e,t,-1)}for(let t=0;t<e.length;t++)0===e[t][1].length&&e.splice(t,1)}(o),o}function eJ(e,t,n){let i=e,r=t;if(i===r)return i?[[eW,i]]:[];let l=eR(i,r),o=i.substring(0,l);l=eL(i=i.substring(l),r=r.substring(l));let s=i.substring(i.length-l),a=function(e,t,n){let i;if(!e)return[[eF,t]];if(!t)return[[ez,e]];let r=e.length>t.length?e:t,l=e.length>t.length?t:e,o=r.indexOf(l);if(-1!==o)return i=[[eF,r.substring(0,o)],[eW,l],[eF,r.substring(o+l.length)]],e.length>t.length&&(i[0][0]=ez,i[2][0]=ez),i;if(1===l.length)return[[ez,e],[eF,t]];let s=function(e,t){let n,i,r,l,o;if((arguments.length>2&&void 0!==arguments[2]?arguments[2]:1)<=0)return null;let s=e.length>t.length?e:t,a=e.length>t.length?t:e;if(s.length<4||2*a.length<s.length)return null;let c=eO(s,a,Math.ceil(s.length/4)),h=eO(s,a,Math.ceil(s.length/2));if(c&&h)n=c[4].length>h[4].length?c:h;else{if(!c&&!h)return null;h?c||(n=h):n=c}if(!n)throw Error("Unable to find a half match.");return e.length>t.length?(i=n[0],r=n[1],l=n[2],o=n[3]):(l=n[0],o=n[1],i=n[2],r=n[3]),[i,r,l,o,n[4]]}(e,t);if(s){let e=s[0],t=s[1],i=s[2],r=s[3],l=s[4],o=eJ(e,i,n),a=eJ(t,r,n);return o.concat([[eW,l]],a)}return n.checkLines&&e.length>100&&t.length>100?function(e,t,n){let i=e,r=t,l=function(e,t){let n=[],i={};function r(e){let t="",r=0,o=-1,s=n.length;for(;o<e.length-1;){-1===(o=e.indexOf(`
`,r))&&(o=e.length-1);let a=e.slice(r,o+1);(i.hasOwnProperty?i.hasOwnProperty(a):void 0!==i[a])?t+=String.fromCharCode(i[a]):(s===l&&(a=e.slice(r),o=e.length),t+=String.fromCharCode(s),i[a]=s,n[s++]=a),r=o+1}return t}n[0]="";let l=4e4,o=r(e);return l=65535,{chars1:o,chars2:r(t),lineArray:n}}(i,r);i=l.chars1,r=l.chars2;let o=l.lineArray,s=eJ(i,r,{checkLines:!1,deadline:n.deadline});(function(e,t){for(let n=0;n<e.length;n++){let i=e[n][1],r=[];for(let e=0;e<i.length;e++)r[e]=t[i.charCodeAt(e)];e[n][1]=r.join("")}})(s,o),(s=function(e){let t=e.map(e=>eM(e)),n=!1,i=[],r=0,l=null,o=0,s=0,a=0,c=0,h=0;for(;o<t.length;)t[o][0]===eW?(i[r++]=o,s=c,a=h,c=0,h=0,l=t[o][1]):(t[o][0]===eF?c+=t[o][1].length:h+=t[o][1].length,l&&l.length<=Math.max(s,a)&&l.length<=Math.max(c,h)&&(t.splice(i[r-1],0,[ez,l]),t[i[r-1]+1][0]=eF,r--,o=--r>0?i[r-1]:-1,s=0,a=0,c=0,h=0,l=null,n=!0)),o++;for(n&&(t=eY(t)),t=eI(t),o=1;o<t.length;){if(t[o-1][0]===ez&&t[o][0]===eF){let e=t[o-1][1],n=t[o][1],i=eA(e,n),r=eA(n,e);i>=r?(i>=e.length/2||i>=n.length/2)&&(t.splice(o,0,[eW,n.substring(0,i)]),t[o-1][1]=e.substring(0,e.length-i),t[o+1][1]=n.substring(i),o++):(r>=e.length/2||r>=n.length/2)&&(t.splice(o,0,[eW,e.substring(0,r)]),t[o-1][0]=eF,t[o-1][1]=n.substring(0,n.length-r),t[o+1][0]=ez,t[o+1][1]=e.substring(r),o++),o++}o++}return t}(s)).push([eW,""]);let a=0,c=0,h=0,d="",p="";for(;a<s.length;){switch(s[a][0]){case eF:h++,p+=s[a][1];break;case ez:c++,d+=s[a][1];break;case eW:if(c>=1&&h>=1){s.splice(a-c-h,c+h),a=a-c-h;let e=eJ(d,p,{checkLines:!1,deadline:n.deadline});for(let t=e.length-1;t>=0;t--)s.splice(a,0,e[t]);a+=e.length}h=0,c=0,d="",p="";break;default:throw Error("Unknown diff operation.")}a++}return s.pop(),s}(e,t,n):function(e,t,n){let i=e.length,r=t.length,l=Math.ceil((i+r)/2),o=2*l,s=Array(o),a=Array(o);for(let e=0;e<o;e++)s[e]=-1,a[e]=-1;s[l+1]=0,a[l+1]=0;let c=i-r,h=c%2!=0,d=0,p=0,u=0,f=0;for(let g=0;g<l&&!(Date.now()>n);g++){for(let u=-g+d;u<=g-p;u+=2){let f;let y=l+u,m=(f=u===-g||u!==g&&s[y-1]<s[y+1]?s[y+1]:s[y-1]+1)-u;for(;f<i&&m<r&&e.charAt(f)===t.charAt(m);)f++,m++;if(s[y]=f,f>i)p+=2;else if(m>r)d+=2;else if(h){let r=l+c-u;if(r>=0&&r<o&&-1!==a[r]&&f>=i-a[r])return ej(e,t,f,m,n)}}for(let d=-g+u;d<=g-f;d+=2){let p;let y=l+d,m=(p=d===-g||d!==g&&a[y-1]<a[y+1]?a[y+1]:a[y-1]+1)-d;for(;p<i&&m<r&&e.charAt(i-p-1)===t.charAt(r-m-1);)p++,m++;if(a[y]=p,p>i)f+=2;else if(m>r)u+=2;else if(!h){let r=l+c-d;if(r>=0&&r<o&&-1!==s[r]){let o=s[r],a=l+o-r;if(o>=(p=i-p))return ej(e,t,o,a,n)}}}}return[[ez,e],[eF,t]]}(e,t,n.deadline)}(i=i.substring(0,i.length-l),r=r.substring(0,r.length-l),n);return o&&a.unshift([eW,o]),s&&a.push([eW,s]),a=eY(a)}function eV(e,t,n){return 1===n?e+t:t+e}function eH(e,t){return 1===t?[e.substring(0,e.length-1),e[e.length-1]]:[e.substring(1),e[0]]}function eU(e,t,n){var i,r;let l=1===n?-1:1,o=null,s=null,a=t+n;for(;a>=0&&a<e.length&&(null===o||null===s);a+=n){let[i,r]=e[a];if(0!==r.length){if(i===eF){null===o&&(o=a);continue}if(i===ez){null===s&&(s=a);continue}if(i===eW){if(null===o&&null===s){let[i,r]=eH(e[t][1],n);e[t][1]=i,e[a][1]=eV(e[a][1],r,l);return}break}}}if(null!==o&&null!==s&&(i=o,r=s,1===n?e[i][1][e[i][1].length-1]===e[r][1][e[r][1].length-1]:e[i][1][0]===e[r][1][0])){let[i,r]=eH(e[o][1],l),[a]=eH(e[s][1],l);e[o][1]=i,e[s][1]=a,e[t][1]=eV(e[t][1],r,n);return}let[c,h]=eH(e[t][1],n);e[t][1]=c,null===o?(e.splice(a,0,[eF,h]),null!==s&&s>=a&&s++):e[o][1]=eV(e[o][1],h,l),null===s?e.splice(a,0,[ez,h]):e[s][1]=eV(e[s][1],h,l)}let eq={threshold:.5,distance:1e3};function eK(e,t,n){if(null===e||null===t||null===n)throw Error("Null input. (match())");let i=Math.max(0,Math.min(n,e.length));return e===t?0:e.length?e.substring(i,i+t.length)===t?i:function(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};if(t.length>32)throw Error("Pattern too long for this browser.");let r={...eq,...i},l=function(e){let t={};for(let n=0;n<e.length;n++)t[e.charAt(n)]=0;for(let n=0;n<e.length;n++)t[e.charAt(n)]|=1<<e.length-n-1;return t}(t);function o(e,i){let l=e/t.length,o=Math.abs(n-i);return r.distance?l+o/r.distance:o?1:l}let s=r.threshold,a=e.indexOf(t,n);-1!==a&&(s=Math.min(o(0,a),s),-1!==(a=e.lastIndexOf(t,n+t.length))&&(s=Math.min(o(0,a),s)));let c=1<<t.length-1;a=-1;let h,d,p=t.length+e.length,u=[];for(let i=0;i<t.length;i++){for(h=0,d=p;h<d;)o(i,n+d)<=s?h=d:p=d,d=Math.floor((p-h)/2+h);p=d;let r=Math.max(1,n-d+1),f=Math.min(n+d,e.length)+t.length,g=Array(f+2);g[f+1]=(1<<i)-1;for(let t=f;t>=r;t--){let h=l[e.charAt(t-1)];if(0===i?g[t]=(g[t+1]<<1|1)&h:g[t]=(g[t+1]<<1|1)&h|((u[t+1]|u[t])<<1|1)|u[t+1],g[t]&c){let e=o(i,t-1);if(e<=s){if(s=e,(a=t-1)>n)r=Math.max(1,2*n-a);else break}}}if(o(i+1,n)>s)break;u=g}return a}(e,t,i):-1}function eZ(e,t){return{diffs:[],start1:e,start2:t,utf8Start1:e,utf8Start2:t,length1:0,length2:0,utf8Length1:0,utf8Length2:0}}function eX(e){let t=[];for(let n=0;n<e.length;n++)e[n][0]!==eF&&(t[n]=e[n][1]);return t.join("")}function eQ(e){let t=[];for(let n=0;n<e.length;n++)e[n][0]!==ez&&(t[n]=e[n][1]);return t.join("")}function e0(e){let t=0;for(let n=0;n<e.length;n++){let i=e.codePointAt(n);if(typeof i>"u")throw Error("Failed to get codepoint");t+=e1(i)}return t}function e1(e){return e<=127?1:e<=2047?2:e<=65535?3:4}function e2(e,t){let n=0,i=0,r=0,l=0,o;for(o=0;o<e.length&&(e[o][0]!==eF&&(n+=e[o][1].length),e[o][0]!==ez&&(i+=e[o][1].length),!(n>t));o++)r=n,l=i;return e.length!==o&&e[o][0]===ez?l:l+(t-r)}let e3=/^@@ -(\d+),?(\d*) \+(\d+),?(\d*) @@$/;function e8(e){if(!e)return[];let t=[],n=e.split(`
`),i=0;for(;i<n.length;){let e=n[i].match(e3);if(!e)throw Error("Invalid patch string: ".concat(n[i]));let r=eZ(e4(e[1]),e4(e[3]));for(t.push(r),""===e[2]?(r.start1--,r.utf8Start1--,r.length1=1,r.utf8Length1=1):"0"===e[2]?(r.length1=0,r.utf8Length1=0):(r.start1--,r.utf8Start1--,r.utf8Length1=e4(e[2]),r.length1=r.utf8Length1),""===e[4]?(r.start2--,r.utf8Start2--,r.length2=1,r.utf8Length2=1):"0"===e[4]?(r.length2=0,r.utf8Length2=0):(r.start2--,r.utf8Start2--,r.utf8Length2=e4(e[4]),r.length2=r.utf8Length2),i++;i<n.length;){let e;let t=n[i],l=t.charAt(0);if("@"===l)break;if(""===l){i++;continue}try{e=decodeURI(t.slice(1))}catch{throw Error("Illegal escape in parse: ".concat(t))}let o=e0(e)-e.length;if("-"===l)r.diffs.push([ez,e]),r.length1-=o;else if("+"===l)r.diffs.push([eF,e]),r.length2-=o;else if(" "===l)r.diffs.push([eW,e]),r.length1-=o,r.length2-=o;else throw Error('Invalid patch mode "'.concat(l,'" in: ').concat(e));i++}}return t}function e4(e){return parseInt(e,10)}let e6=O("applyPatches"),e5=e6.enabled&&!0;function e9(e){return"object"==typeof e&&"_key"in e}function e7(e,t){e5&&(e6(`Children ${t}:`,JSON.stringify(e.children,null,2)),e6(`Selection ${t}: `,JSON.stringify(e.selection,null,2)))}function te(e,t){let{block:n,path:i}=function(e,t){let n=-1,i=e.children.find((e,i)=>{let r=e9(t[0])?e._key===t[0]._key:i===t[0];return r&&(n=i),r});return i?{block:i,path:[n]}:{}}(e,t);if(!(c.W_.isElement(n)&&"children"===t[1]))return{block:n,blockPath:i,child:void 0,childPath:void 0};let r=-1,l=n.children.find((e,n)=>{let i=e9(t[2])?e._key===t[2]._key:n===t[2];return i&&(r=n),i});return l?{block:n,child:l,blockPath:i,childPath:i?.concat(r)}:{block:n,blockPath:i,child:void 0,childPath:void 0}}let tt=new WeakMap;function tn(e,t){let n=tt.get(e);tt.set(e,!1),t(),tt.set(e,n)}let ti=O("plugin:withUndoRedo"),tr=ti.enabled&&!1,tl=new WeakMap,to=new WeakMap,ts=e=>{let t=tl.get(e);return void 0===t||t},ta=e=>(to.get(e)||to.set(e,[]),to.get(e)||[]);function tc(e,t,n,i,r){tr&&(ti(`Adjusting '${n.type}' operation paths for '${t.type}' patch`),ti(`Operation ${JSON.stringify(n)}`),ti(`Patch ${JSON.stringify(t)}`));let l={...n};if("insert"===t.type&&1===t.path.length){let e=(i||[]).findIndex(e=>o({_key:e._key},t.path[0]));return ti(`Adjusting block path (+${t.items.length}) for '${l.type}' operation and patch '${t.type}'`),[th(l,t.items.length,e)]}if("unset"===t.type&&1===t.path.length){let n=(r||[]).findIndex(e=>o({_key:e._key},t.path[0]));return"path"in l&&Array.isArray(l.path)&&l.path[0]===n?(ti("Skipping transformation that targeted removed block"),[]):(tr&&(ti(`Selection ${JSON.stringify(e.selection)}`),ti(`Adjusting block path (-1) for '${l.type}' operation and patch '${t.type}'`)),[th(l,-1,n)])}if("unset"===t.type&&0===t.path.length)return ti(`Adjusting selection for unset everything patch and ${n.type} operation`),[];if("diffMatchPatch"===t.type){let n;let i=("set_selection"===l.type&&e.selection?n=e.children[e.selection.focus.path[0]]:"path"in l&&(n=e.children[l.path[0]]),n);return i&&o({_key:i._key},t.path[0])&&e8(t.value).forEach(e=>{let t=0,n=e.utf8Start1,{diffs:i}=e;if(i.forEach((e,r)=>{let[l,o]=e;l===eF?(t+=o.length,n+=o.length):l===ez?(t-=o.length,n-=o.length):l===eW&&(i.slice(r).every(([e])=>e===eW)||(n+=o.length))}),"insert_text"===l.type&&n<l.offset&&(l.offset+=t),"remove_text"===l.type&&n<=l.offset-l.text.length&&(l.offset+=t),"set_selection"===l.type){let e=l.properties?.focus?{...l.properties.focus}:void 0,i=l?.properties?.anchor?{...l.properties.anchor}:void 0,r=l?.newProperties?.focus?{...l.newProperties.focus}:void 0,o=l?.newProperties?.anchor?{...l.newProperties.anchor}:void 0;(e&&i||r&&o)&&([e,i,r,o].forEach(e=>{e&&n<e.offset&&(e.offset+=t)}),e&&i&&(l.properties={focus:e,anchor:i}),r&&o&&(l.newProperties={focus:r,anchor:o}))}}),[l]}return[l]}function th(e,t,n){let i={...e};if(n>=0&&"set_selection"!==i.type&&Array.isArray(i.path)&&i.path[0]>=n+t&&i.path[0]+t>-1){let e=[i.path[0]+t,...i.path.slice(1)];i.path=e}if("set_selection"===i.type){let e=i.properties?.focus?{...i.properties.focus}:void 0,r=i?.properties?.anchor?{...i.properties.anchor}:void 0,l=i?.newProperties?.focus?{...i.newProperties.focus}:void 0,o=i?.newProperties?.anchor?{...i.newProperties.anchor}:void 0;(e&&r||l&&o)&&([e,r,l,o].forEach(e=>{e&&e.path[0]>=n+t&&e.path[0]+t>-1&&(e.path=[e.path[0]+t,...e.path.slice(1)])}),e&&r&&(i.properties={focus:e,anchor:r}),l&&o&&(i.newProperties={focus:l,anchor:o}))}return i}let td=(e,t)=>!!("set_selection"===e.type||t&&"insert_text"===e.type&&"insert_text"===t.type&&e.offset===t.offset+t.text.length&&c.y$.equals(e.path,t.path)&&" "!==e.text||t&&"remove_text"===e.type&&"remove_text"===t.type&&e.offset+e.text.length===t.offset&&c.y$.equals(e.path,t.path)),tp=(e,t)=>!!(t&&"set_selection"===e.type&&"set_selection"===t.type),tu=e=>"set_selection"!==e.type;function tf(e,t){let n=ts(e);tl.set(e,!1),t(),tl.set(e,n)}let tg=O("plugin:withPatches"),ty=O("plugin:withPlaceholderBlock"),tm=O("plugin:withPortableTextBlockStyle"),tk=O("plugin:withPortableTextLists");function tb(e){return"span"===e._type&&"text"in e&&"string"==typeof e.text&&(typeof e.marks>"u"||Array.isArray(e.marks)&&e.marks.every(e=>"string"==typeof e))}function tv({editor:e,blockPath:t,spanPath:n}){let i;for(let[r,l]of c.NB.children(e,t,{reverse:!0}))if(e.isTextSpan(r)&&c.y$.isBefore(l,n)){i=r;break}return i}function tx({editor:e,blockPath:t,spanPath:n}){let i;for(let[r,l]of c.NB.children(e,t))if(e.isTextSpan(r)&&c.y$.isAfter(l,n)){i=r;break}return i}let t_=O("plugin:withPortableTextMarkModel"),tN=O("plugin:withPortableTextSelections"),tw=tN.enabled&&!1,tT=O("plugin:withSchemaTypes"),tS=O("plugin:withUtils"),tE=O("plugin:withHotKeys"),tM={marks:{"mod+b":"strong","mod+i":"em","mod+u":"underline","mod+'":"code"},custom:{}};function tA(e,t,n){let r=null,l=!0,o=[t.span.name,...t.inlineObjects.map(e=>e.name)],s=[t.block.name,...t.blockObjects.map(e=>e.name)];return void 0===e?{valid:!0,resolution:null,value:e}:Array.isArray(e)&&0!==e.length?(e.some((e,a)=>{if(!E(e))return r={patches:[(0,v.zN)([a])],description:`Block must be an object, got ${String(e)}`,action:"Unset invalid item",item:e,i18n:{description:"inputs.portable-text.invalid-value.not-an-object.description",action:"inputs.portable-text.invalid-value.not-an-object.action",values:{index:a}}},!0;if(!e._key||"string"!=typeof e._key)return r={patches:[(0,v.t8)({...e,_key:n()},[a])],description:`Block at index ${a} is missing required _key.`,action:"Set the block with a random _key value",item:e,i18n:{description:"inputs.portable-text.invalid-value.missing-key.description",action:"inputs.portable-text.invalid-value.missing-key.action",values:{index:a}}},!0;if(!e._type||!s.includes(e._type)){if("block"===e._type){let n=t.block.name;return r={patches:[(0,v.t8)({...e,_type:n},[{_key:e._key}])],description:`Block with _key '${e._key}' has invalid type name '${e._type}'. According to the schema, the block type name is '${n}'`,action:`Use type '${n}'`,item:e,i18n:{description:"inputs.portable-text.invalid-value.incorrect-block-type.description",action:"inputs.portable-text.invalid-value.incorrect-block-type.action",values:{key:e._key,expectedTypeName:n}}},!0}return r=!e._type&&(0,i.DG)({...e,_type:t.block.name})?{patches:[(0,v.t8)({...e,_type:t.block.name},[{_key:e._key}])],description:`Block with _key '${e._key}' is missing a type name. According to the schema, the block type name is '${t.block.name}'`,action:`Use type '${t.block.name}'`,item:e,i18n:{description:"inputs.portable-text.invalid-value.missing-block-type.description",action:"inputs.portable-text.invalid-value.missing-block-type.action",values:{key:e._key,expectedTypeName:t.block.name}}}:e._type?{patches:[(0,v.zN)([{_key:e._key}])],description:`Block with _key '${e._key}' has invalid _type '${e._type}'`,action:"Remove the block",item:e,i18n:{description:"inputs.portable-text.invalid-value.disallowed-type.description",action:"inputs.portable-text.invalid-value.disallowed-type.action",values:{key:e._key,typeName:e._type}}}:{patches:[(0,v.zN)([{_key:e._key}])],description:`Block with _key '${e._key}' is missing an _type property`,action:"Remove the block",item:e,i18n:{description:"inputs.portable-text.invalid-value.missing-type.description",action:"inputs.portable-text.invalid-value.missing-type.action",values:{key:e._key}}},!0}if(e._type===t.block.name){if(e.children&&!Array.isArray(e.children))return r={patches:[(0,v.t8)({children:[]},[{_key:e._key}])],description:`Text block with _key '${e._key}' has a invalid required property 'children'.`,action:"Reset the children property",item:e,i18n:{description:"inputs.portable-text.invalid-value.missing-or-invalid-children.description",action:"inputs.portable-text.invalid-value.missing-or-invalid-children.action",values:{key:e._key}}},!0;if(void 0===e.children||Array.isArray(e.children)&&0===e.children.length){let i={_type:t.span.name,_key:n(),text:"",marks:[]};return r={autoResolve:!0,patches:[(0,v.Cb)([],[{_key:e._key},"children"]),(0,v.$T)([i],"after",[{_key:e._key},"children",0])],description:`Children for text block with _key '${e._key}' is empty.`,action:"Insert an empty text",item:e,i18n:{description:"inputs.portable-text.invalid-value.empty-children.description",action:"inputs.portable-text.invalid-value.empty-children.action",values:{key:e._key}}},!0}let i=f(w(e.children.filter(e=>e._type===t.span.name).map(e=>e.marks||[])));if(Array.isArray(e.markDefs)&&e.markDefs.length>0){let t=f(e.markDefs.map(e=>e._key).filter(e=>!i.includes(e)));if(t.length>0)return r={autoResolve:!0,patches:t.map(t=>(0,v.zN)([{_key:e._key},"markDefs",{_key:t}])),description:`Block contains orphaned data (unused mark definitions): ${t.join(", ")}.`,action:"Remove unused mark definition item",item:e,i18n:{description:"inputs.portable-text.invalid-value.orphaned-mark-defs.description",action:"inputs.portable-text.invalid-value.orphaned-mark-defs.action",values:{key:e._key,unusedMarkDefs:t.map(e=>e.toString())}}},!0}let s=i.filter(e=>!t.decorators.map(e=>e.value).includes(e)).filter(t=>void 0===e.markDefs||!e.markDefs.find(e=>e._key===t));if(s.length>0){let n=e.children.filter(e=>e._type===t.span.name&&Array.isArray(e.marks)&&e.marks.some(e=>s.includes(e)));if(n){let t=s.join(", ");return r={autoResolve:!0,patches:n.map(t=>(0,v.t8)((t.marks||[]).filter(e=>!s.includes(e)),[{_key:e._key},"children",{_key:t._key},"marks"])),description:`Block with _key '${e._key}' contains marks (${t}) not supported by the current content model.`,action:"Remove invalid marks",item:e,i18n:{description:"inputs.portable-text.invalid-value.orphaned-marks.description",action:"inputs.portable-text.invalid-value.orphaned-marks.action",values:{key:e._key,orphanedMarks:s.map(e=>e.toString())}}},!0}}e.children.some((i,l)=>{if(!E(i))return r={patches:[(0,v.zN)([{_key:e._key},"children",l])],description:`Child at index '${l}' in block with key '${e._key}' is not an object.`,action:"Remove the item",item:e,i18n:{description:"inputs.portable-text.invalid-value.non-object-child.description",action:"inputs.portable-text.invalid-value.non-object-child.action",values:{key:e._key,index:l}}},!0;if(!i._key||"string"!=typeof i._key){let t={...i,_key:n()};return r={autoResolve:!0,patches:[(0,v.t8)(t,[{_key:e._key},"children",l])],description:`Child at index ${l} is missing required _key in block with _key ${e._key}.`,action:"Set a new random _key on the object",item:e,i18n:{description:"inputs.portable-text.invalid-value.missing-child-key.description",action:"inputs.portable-text.invalid-value.missing-child-key.action",values:{key:e._key,index:l}}},!0}return i._type?o.includes(i._type)?i._type===t.span.name&&"string"!=typeof i.text&&(r={patches:[(0,v.t8)({...i,text:""},[{_key:e._key},"children",{_key:i._key}])],description:`Child with _key '${i._key}' in block with key '${e._key}' has missing or invalid text property!`,action:"Write an empty text property to the object",item:e,i18n:{description:"inputs.portable-text.invalid-value.invalid-span-text.description",action:"inputs.portable-text.invalid-value.invalid-span-text.action",values:{key:e._key,childKey:i._key}}},!0):(r={patches:[(0,v.zN)([{_key:e._key},"children",{_key:i._key}])],description:`Child with _key '${i._key}' in block with key '${e._key}' has invalid '_type' property (${i._type}).`,action:"Remove the object",item:e,i18n:{description:"inputs.portable-text.invalid-value.disallowed-child-type.description",action:"inputs.portable-text.invalid-value.disallowed-child-type.action",values:{key:e._key,childKey:i._key,childType:i._type}}},!0):(r={patches:[(0,v.zN)([{_key:e._key},"children",{_key:i._key}])],description:`Child with _key '${i._key}' in block with key '${e._key}' is missing '_type' property.`,action:"Remove the object",item:e,i18n:{description:"inputs.portable-text.invalid-value.missing-child-type.description",action:"inputs.portable-text.invalid-value.missing-child-type.action",values:{key:e._key,childKey:i._key}}},!0)})&&(l=!1)}return!1})&&(l=!1),{valid:l,resolution:r,value:e}):{valid:!1,resolution:{patches:[(0,v.zN)([])],description:"Editor value must be an array of Portable Text blocks, or undefined.",action:"Unset the value",item:e,i18n:{description:"inputs.portable-text.invalid-value.not-an-array.description",action:"inputs.portable-text.invalid-value.not-an-array.action"}},value:e}}let tR=O("plugin:withInsertData"),tL={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"};function tC(e,t,n){e.withoutNormalizing(()=>{if(!e.selection)return;let[i,r]=c.ML.node(e,e.selection,{depth:1});if(e.isTextBlock(i)&&e.isTextBlock(t[0])){let{markDefs:n}=i;tR("Mixing markDefs of focusBlock and fragments[0] block",n,t[0].markDefs),o(n,t[0].markDefs)||c.YR.setNodes(e,{markDefs:f([...t[0].markDefs||[],...n||[]])},{at:r,mode:"lowest",voids:!1})}K(e.children,n)?(c.YR.splitNodes(e,{at:[0,0]}),e.insertFragment(t),c.YR.removeNodes(e,{at:[0]})):e.insertFragment(t)}),e.onChange()}let tB=new WeakMap,tD=(e,t)=>{var n,r;let l;let{editorActor:a,portableTextEditor:d,readOnly:p,maxBlocks:u}=t,{schemaTypes:g}=d;e.subscriptions=[],e.destroy?e.destroy():tB.set(e,{apply:e.apply,onChange:e.onChange,normalizeNode:e.normalizeNode});let y=function(e){let t=e.block.name;return{insertNodePatch:function(e,n,i){let r=i[n.path[0]],l=e.isTextBlock(r);if(1===n.path.length){let e=0===n.path[0]?"before":"after",l=i[n.path[0]-1],o=0===n.path[0]?r?._key:l?._key;return o?[(0,v.$T)([q([n.node],t)[0]],e,[{_key:o}])]:[(0,v.Cb)(i,[]),(0,v.$T)([q([n.node],t)[0]],"before",[n.path[0]])]}if(l&&2===n.path.length&&e.children[n.path[0]]){let e=0!==r.children.length&&r.children[n.path[1]-1]?"after":"before",i={...n.node};!i._type&&c.xv.isText(i)&&(i._type="span",i.marks=[]);let l=q([{_key:"bogus",_type:t,children:[i]}],t)[0].children[0];return[(0,v.$T)([l],e,[{_key:r._key},"children",r.children.length<=1||!r.children[n.path[1]-1]?0:{_key:r.children[n.path[1]-1]._key}])]}return ev("Something was inserted into a void block. Not producing editor patches."),[]},insertTextPatch:function(e,t,n){ev.enabled&&ev("Operation",JSON.stringify(t,null,2));let i=e.isTextBlock(e.children[t.path[0]])&&e.children[t.path[0]];if(!i)throw Error("Could not find block");let r=e.isTextBlock(i)&&e.isTextSpan(i.children[t.path[1]])&&i.children[t.path[1]];if(!r)throw Error("Could not find child");let l=[{_key:i._key},"children",{_key:r._key},"text"],o=n[t.path[0]],s=e.isTextBlock(o)&&o.children[t.path[1]],a=e.isTextSpan(s)?s.text:"",c=(0,v.aH)(a,r.text,l);return c.value.length?[c]:[]},mergeNodePatch:function(e,n,i){let r=[],l=i[n.path[0]],o=e.children[n.path[0]];if(1===n.path.length){if(l?._key){let i=q([e.children[n.path[0]-1]],t)[0];r.push((0,v.t8)(i,[{_key:i._key}])),r.push((0,v.zN)([{_key:l._key}]))}else throw Error("Target key not found!")}else if(e.isTextBlock(l)&&e.isTextBlock(o)&&2===n.path.length){let t=o.children[n.path[1]-1]&&e.isTextSpan(o.children[n.path[1]-1])?o.children[n.path[1]-1]:void 0,i=l.children[n.path[1]]&&e.isTextSpan(l.children[n.path[1]])?l.children[n.path[1]]:void 0;t&&(1===l.children.filter(e=>e._key===t._key).length?r.push((0,v.t8)(t.text,[{_key:l._key},"children",{_key:t._key},"text"])):console.warn(`Multiple spans have \`_key\` ${t._key}. It's ambiguous which one to update.`,JSON.stringify(l,null,2))),i&&(1===l.children.filter(e=>e._key===i._key).length?r.push((0,v.zN)([{_key:l._key},"children",{_key:i._key}])):console.warn(`Multiple spans have \`_key\` ${i._key}. It's ambiguous which one to remove.`,JSON.stringify(l,null,2)))}else ev("Void nodes can't be merged, not creating any patches");return r},moveNodePatch:function(e,n,i){let r=[],l=i[n.path[0]],o=i[n.newPath[0]];if(1===n.path.length){let e=n.path[0]>n.newPath[0]?"before":"after";r.push((0,v.zN)([{_key:l._key}])),r.push((0,v.$T)([q([l],t)[0]],e,[{_key:o._key}]))}else if(2===n.path.length&&e.isTextBlock(l)&&e.isTextBlock(o)){let e=l.children[n.path[1]],i=o.children[n.newPath[1]],s=n.newPath[1]===o.children.length?"after":"before",a=q([l],t)[0].children[n.path[1]];r.push((0,v.zN)([{_key:l._key},"children",{_key:e._key}])),r.push((0,v.$T)([a],s,[{_key:o._key},"children",{_key:i._key}]))}return r},removeNodePatch:function(e,t,n){let i=n[t.path[0]];if(1===t.path.length){if(i&&i._key)return[(0,v.zN)([{_key:i._key}])];throw Error("Block not found")}if(!e.isTextBlock(i)||2!==t.path.length)return ev("Not creating patch inside object block"),[];{let e=i.children[t.path[1]];return e?i.children.filter(e=>e._key===t.node._key).length>1?(console.warn(`Multiple spans have \`_key\` ${t.node._key}. It's ambiguous which one to remove.`,JSON.stringify(i,null,2)),[]):[(0,v.zN)([{_key:i._key},"children",{_key:e._key}])]:(ev("Span not found in editor trying to remove node"),[])}},removeTextPatch:function(e,t,n){let i=e&&e.children[t.path[0]];if(!i)throw Error("Could not find block");let r=e.isTextBlock(i)&&i.children[t.path[1]]||void 0,l=e.isTextSpan(r)?r:void 0;if(r&&!l)throw Error("Expected span");if(!l)throw Error("Could not find child");let o=[{_key:i._key},"children",{_key:l._key},"text"],s=n[t.path[0]],a=e.isTextBlock(s)&&s.children[t.path[1]],c=e.isTextSpan(a)&&a.text,h=(0,v.aH)(c||"",l.text,o);return h.value?[h]:[]},setNodePatch:function(e,n){if(1===n.path.length){let i=e.children[n.path[0]];if("string"!=typeof i._key)throw Error("Expected block to have a _key");let r=N({...e.children[n.path[0]],...n.newProperties},_);return[(0,v.t8)(q([r],t)[0],[{_key:i._key}])]}if(2===n.path.length){let t=e.children[n.path[0]];if(e.isTextBlock(t)){let e=t.children[n.path[1]];if(e){let i=t._key,r=e._key,l=[],o=Object.keys(n.newProperties);return o.forEach(s=>{if(1===o.length&&"_key"===s){let r=x(n.newProperties,s);l.push((0,v.t8)(r,[{_key:i},"children",t.children.indexOf(e),s]))}else{let e=x(n.newProperties,s);l.push((0,v.t8)(e,[{_key:i},"children",{_key:r},s]))}}),l}throw Error("Could not find a valid child")}throw Error("Could not find a valid block")}throw Error(`Unexpected path encountered: ${JSON.stringify(n.path)}`)},splitNodePatch:function(e,n,i){let r=[],l=e.children[n.path[0]];if(!e.isTextBlock(l))throw Error(`Block with path ${JSON.stringify(n.path[0])} is not a text block and can't be split`);if(1===n.path.length){let o=i[n.path[0]];if(e.isTextBlock(o)){let i=q([e.children[n.path[0]+1]],t)[0];i&&(r.push((0,v.$T)([i],"after",[{_key:l._key}])),o.children.slice(n.position).forEach(e=>{let t=[{_key:o._key},"children",{_key:e._key}];r.push((0,v.zN)(t))}))}return r}if(2===n.path.length){let i=l.children[n.path[1]];if(e.isTextSpan(i)){let e=q([{...l,children:l.children.slice(n.path[1]+1,n.path[1]+2)}],t)[0].children;r.push((0,v.$T)(e,"after",[{_key:l._key},"children",{_key:i._key}])),r.push((0,v.t8)(i.text,[{_key:l._key},"children",{_key:i._key},"text"]))}}return r}}}(g),m=function(e){let{apply:t,normalizeNode:n}=e;return e.apply=n=>{if(eN(e)||eS(e)||eE(e)){t(n);return}if("split_node"===n.type){t({...n,properties:{...n.properties,_key:a.getSnapshot().context.keyGenerator()}});return}if("insert_node"===n.type&&!c.ML.isEditor(n.node)){t({...n,node:{...n.node,_key:a.getSnapshot().context.keyGenerator()}});return}t(n)},e.normalizeNode=t=>{let[i,r]=t;if(c.W_.isElement(i)&&i._type===g.block.name){if(!i._key){a.send({type:"normalizing"}),c.YR.setNodes(e,{_key:a.getSnapshot().context.keyGenerator()},{at:r}),a.send({type:"done normalizing"});return}for(let[t,n]of c.NB.children(e,r))if(!t._key){a.send({type:"normalizing"}),c.YR.setNodes(e,{_key:a.getSnapshot().context.keyGenerator()},{at:n}),a.send({type:"done normalizing"});return}}n(t)},e},k=function({editorActor:e,schemaTypes:t}){return function(n){n.isTextBlock=e=>(0,i.DG)(e)&&e._type===t.block.name,n.isTextSpan=e=>(0,i.NG)(e)&&e._type===t.span.name,n.isListBlock=e=>(0,i.KA)(e)&&e._type===t.block.name,n.isVoid=e=>t.block.name!==e._type&&(t.blockObjects.map(e=>e.name).includes(e._type)||t.inlineObjects.map(e=>e.name).includes(e._type)),n.isInline=e=>t.inlineObjects.map(e=>e.name).includes(e._type)&&"__inline"in e&&!0===e.__inline;let{normalizeNode:r}=n;return n.normalizeNode=i=>{let[l,o]=i;if(void 0===l._type&&2===o.length){tT("Setting span type on text node without a type");let i=l._key||e.getSnapshot().context.keyGenerator();e.send({type:"normalizing"}),c.YR.setNodes(n,{...l,_type:t.span.name,_key:i},{at:o}),e.send({type:"done normalizing"});return}if(void 0===l._key&&(1===o.length||2===o.length)){tT("Setting missing key on child node without a key");let t=e.getSnapshot().context.keyGenerator();e.send({type:"normalizing"}),c.YR.setNodes(n,{_key:t},{at:o}),e.send({type:"done normalizing"});return}r(i)},n}}({editorActor:a,schemaTypes:g}),b=function(e){return d.setEditable({focus:()=>{h.F3.focus(e)},blur:()=>{h.F3.blur(e)},toggleMark:t=>{e.pteToggleMark(t)},toggleList:t=>{e.pteToggleListItem(t)},toggleBlockStyle:t=>{e.pteToggleBlockStyle(t)},isMarkActive:t=>{try{return e.pteIsMarkActive(t)}catch(e){return console.warn(e),!1}},marks:()=>({...c.ML.marks(e)||{}}).marks||[],undo:()=>e.undo(),redo:()=>e.redo(),select:t=>{let n=G(t,e);n?c.YR.select(e,n):c.YR.deselect(e),e.onChange()},focusBlock:()=>{if(e.selection){let t=c.NB.descendant(e,e.selection.focus.path.slice(0,1));if(t)return q([t],g.block.name,er.get(e))[0]}},focusChild:()=>{if(e.selection){let t=c.NB.descendant(e,e.selection.focus.path.slice(0,1));if(t&&e.isTextBlock(t))return q([t],g.block.name,er.get(e))[0].children[e.selection.focus.path[1]]}},insertChild:(t,n)=>{if(!e.selection)throw Error("The editor has no selection");let[i]=Array.from(c.ML.nodes(e,{at:e.selection.focus.path.slice(0,1),match:e=>e._type===g.block.name}))[0]||[void 0];if(!i)throw Error("No focused text block");if(t.name!==g.span.name&&!g.inlineObjects.some(e=>e.name===t.name))throw Error("This type cannot be inserted as a child to a text block");let r=U([{_key:a.getSnapshot().context.keyGenerator(),_type:g.block.name,children:[{_key:a.getSnapshot().context.keyGenerator(),_type:t.name,...n||{}}]}],d)[0].children[0],l=e.selection.focus.path.slice(0,2),o=r._type===g.span.name,s=c.NB.get(e,l);return o&&s._type!==g.span.name&&(ex("Inserting span child next to inline object child, moving selection + 1"),e.move({distance:1,unit:"character"})),c.YR.insertNodes(e,r,{select:!0,at:e.selection}),e.onChange(),W(q(e.children,g.block.name,er.get(e)),e.selection,g)?.focus.path||[]},insertBlock:(t,n)=>{let i=U([{_key:a.getSnapshot().context.keyGenerator(),_type:t.name,...n||{}}],d)[0];if(!e.selection){let t=Array.from(c.ML.nodes(e,{match:e=>!c.ML.isEditor(e),at:[],reverse:!0}))[0];return c.ML.insertNode(e,i),t&&K([t[0]],g)&&c.YR.removeNodes(e,{at:t[1]}),e.onChange(),W(q(e.children,g.block.name,er.get(e)),e.selection,g)?.focus.path??[]}let r=Array.from(c.ML.nodes(e,{at:e.selection.focus.path.slice(0,1),match:e=>e._type===g.block.name}))[0];return c.ML.insertNode(e,i),r&&K([r[0]],g)&&c.YR.removeNodes(e,{at:r[1]}),e.onChange(),W(q(e.children,g.block.name,er.get(e)),e.selection,g)?.focus.path||[]},hasBlockStyle:t=>{try{return e.pteHasBlockStyle(t)}catch{return!1}},hasListStyle:t=>{try{return e.pteHasListStyle(t)}catch{return!1}},isVoid:e=>![g.block.name,g.span.name].includes(e._type),findByPath:t=>{let n=G({focus:{path:t,offset:0},anchor:{path:t,offset:0}},e);if(n){let[i,r]=c.ML.node(e,n.focus.path.slice(0,1));if(i&&r&&"string"==typeof i._key){if(1===t.length&&1===n.focus.path.length)return[q([i],g.block.name)[0],[{_key:i._key}]];let r=q([i],g.block.name,er.get(e))[0];if(e.isTextBlock(r)){let e=r.children[n.focus.path[1]];if(e)return[e,[{_key:i._key},"children",{_key:e._key}]]}}}return[void 0,void 0]},findDOMNode:t=>{let n;try{let[i]=Array.from(c.ML.nodes(e,{at:[],match:e=>e._key===t._key})||[])[0]||[void 0];n=h.F3.toDOMNode(e,i)}catch{}return n},activeAnnotations:()=>{if(!e.selection||e.selection.focus.path.length<2)return[];try{let t=[];for(let[n,i]of c.ML.nodes(e,{at:e.selection,match:e=>c.xv.isText(e)&&void 0!==e.marks&&Array.isArray(e.marks)&&e.marks.length>0})){let[r]=c.ML.node(e,i,{depth:1});e.isTextBlock(r)&&r.markDefs?.forEach(e=>{c.xv.isText(n)&&n.marks&&Array.isArray(n.marks)&&n.marks.includes(e._key)&&t.push(e)})}return t}catch{return[]}},isAnnotationActive:t=>{if(!e.selection||e.selection.focus.path.length<2)return!1;try{let n=[...c.ML.nodes(e,{at:e.selection,match:e=>c.xv.isText(e)})];if(0===n.length||n.some(([e])=>!(0,i.NG)(e)||!e.marks||e.marks?.length===0))return!1;let r=n.reduce((t,[,n])=>{let[i]=c.ML.node(e,n,{depth:1});return e.isTextBlock(i)&&i.markDefs?[...t,...i.markDefs]:t},[]);return n.every(([e])=>!!(0,i.NG)(e)&&e.marks?.map(e=>r.find(t=>t?._key===e)?._type)?.includes(t))}catch{return!1}},addAnnotation:(t,n)=>{let i;let{selection:r}=e;if(r&&(c.e6.isCollapsed(r)&&(e.pteExpandToWord(),e.onChange()),e.selection)){let r,l;let o=[];c.ML.withoutNormalizing(e,()=>{if(e.selection){for(let[i,s]of c.ML.nodes(e,{at:e.selection,match:t=>e.isTextBlock(t),reverse:c.e6.isBackward(e.selection)})){if(0===i.children.length||1===i.children.length&&""===i.children[0].text)continue;let h=a.getSnapshot().context.keyGenerator(),d=i.markDefs??[];for(let[a,p]of(void 0===d.find(e=>e._type===t.name&&e._key===h)&&(c.YR.setNodes(e,{markDefs:[...d,{_type:t.name,_key:h,...n}]},{at:s}),l=[{_key:i._key},"markDefs",{_key:h}],c.e6.isBackward(e.selection)?o.unshift(l):o.push(l)),c.YR.setNodes(e,{},{match:c.xv.isText,split:!0}),c.NB.children(e,s))){if(!e.isTextSpan(a)||!c.e6.includes(e.selection,p))continue;let n=a.marks??[],l=n.filter(e=>d.some(n=>n._key===e&&n._type===t.name));c.YR.setNodes(e,{marks:[...n.filter(e=>!l.includes(e)),h]},{at:p}),r=[{_key:i._key},"children",{_key:a._key}]}}l&&r&&(i={markDefPath:l,markDefPaths:o,spanPath:r})}}),e.onChange()}return i},delete:(t,n)=>{if(t){let i=G(t,e);if(!(i&&i.anchor.path.length>0&&i.focus.path.length>0))throw Error("Invalid range");if(i){if(!n?.mode||n?.mode==="selected"){ex("Deleting content in selection"),c.YR.delete(e,{at:i,hanging:!0,voids:!0}),e.onChange();return}n?.mode==="blocks"&&(ex("Deleting blocks touched by selection"),c.YR.removeNodes(e,{at:i,voids:!0,match:t=>e.isTextBlock(t)||!e.isTextBlock(t)&&c.W_.isElement(t)})),n?.mode==="children"&&(ex("Deleting children touched by selection"),c.YR.removeNodes(e,{at:i,voids:!0,match:t=>t._type===g.span.name||!e.isTextBlock(t)&&c.W_.isElement(t)})),0===e.children.length&&(e.children=[e.pteCreateTextBlock({decorators:[]})]),e.onChange()}}},removeAnnotation:t=>{ex("Removing annotation",t),c.ML.withoutNormalizing(e,()=>{if(e.selection){if(c.e6.isCollapsed(e.selection)){let[n,i]=c.ML.node(e,e.selection,{depth:1});if(!e.isTextBlock(n))return;let r=(n.markDefs??[]).filter(e=>e._type===t.name),[l,o]=c.ML.node(e,e.selection,{depth:2});if(!e.isTextSpan(l))return;let s=l.marks?.find(e=>r.some(t=>t._key===e));if(!s)return;let a=[];for(let[t,n]of c.NB.children(e,i,{reverse:!0}))if(e.isTextSpan(t)&&c.y$.isBefore(n,o)){if(t.marks?.includes(s))a.push([t,n]);else break}let h=[];for(let[t,n]of c.NB.children(e,i))if(e.isTextSpan(t)&&c.y$.isAfter(n,o)){if(t.marks?.includes(s))h.push([t,n]);else break}for(let[t,n]of[...a,[l,o],...h])c.YR.setNodes(e,{marks:t.marks?.filter(e=>e!==s)},{at:n})}else for(let[n,i]of(c.YR.setNodes(e,{},{match:t=>e.isTextSpan(t),split:!0,hanging:!0}),c.ML.nodes(e,{at:e.selection,match:t=>e.isTextBlock(t)})))for(let[r,l]of c.NB.children(e,i)){if(!e.isTextSpan(r)||!c.e6.includes(e.selection,l))continue;let i=n.markDefs??[],o=r.marks??[],s=o.filter(e=>i.find(t=>t._key===e)?._type!==t.name);s.length!==o.length&&c.YR.setNodes(e,{marks:s},{at:l})}}}),e.onChange()},getSelection:()=>{let t=null;if(e.selection){let n=el.get(e.selection);if(n)return n;t=W(q(e.children,g.block.name,er.get(e)),e.selection,g),el.set(e.selection,t)}return t},getValue:()=>q(e.children,g.block.name,er.get(e)),isCollapsedSelection:()=>!!e.selection&&c.e6.isCollapsed(e.selection),isExpandedSelection:()=>!!e.selection&&c.e6.isExpanded(e.selection),insertBreak:()=>{e.insertBreak(),e.onChange()},getFragment:()=>q(e.getFragment(),g.block.name),isSelectionsOverlapping:(t,n)=>{let i=G(t,e),r=G(n,e);return c.e6.isRange(i)&&c.e6.isRange(r)&&c.e6.includes(i,r)}}),e},T=function({editorActor:e,patchFunctions:t,readOnly:n,schemaTypes:i}){let r;let l=(e,t)=>{let n=!1;e5&&(e6(`

NEW PATCH =============================================================`),e6(JSON.stringify(t,null,2)));try{switch(t.type){case"insert":n=function(e,t,n){let{block:i,child:r,blockPath:l,childPath:o}=te(e,t.path);if(!i||!l)return e6("Block not found"),!1;if(t.path.length>1&&"children"!==t.path[1])return e6("Ignoring patch targeting void value"),!1;if(1===t.path.length){let{items:i,position:r}=t,o=U(i,{schemaTypes:n},ei.get(e)),s=l[0],a="after"===r?s+1:s;return e6(`Inserting blocks at path [${a}]`),e7(e,"before"),c.YR.insertNodes(e,o,{at:[a]}),e7(e,"after"),!0}let{items:s,position:a}=t;if(!r||!o)return e6("Child not found"),!1;let h=i&&U([{...i,children:s}],{schemaTypes:n},ei.get(e)),d=o[1],p=[o[0],"after"===a?d+1:d];return e6(`Inserting children at path ${p}`),e7(e,"before"),h&&c.W_.isElement(h[0])&&c.YR.insertNodes(e,h[0].children,{at:p}),e7(e,"after"),!0}(e,t,i);break;case"unset":n=function(e,t){if(0===t.path.length){e6("Removing everything"),e7(e,"before");let t=e.selection;return c.YR.deselect(e),e.children.forEach((t,n)=>{c.YR.removeNodes(e,{at:[n]})}),c.YR.insertNodes(e,e.pteCreateTextBlock({decorators:[]})),t&&c.YR.select(e,{anchor:{path:[0,0],offset:0},focus:{path:[0,0],offset:0}}),e.onChange(),e7(e,"after"),!0}let{block:n,blockPath:i,child:r,childPath:l}=te(e,t.path);if(1===t.path.length){if(!n||!i)return e6("Block not found"),!1;let t=i[0];return e6(`Removing block at path [${t}]`),e7(e,"before"),c.YR.removeNodes(e,{at:[t]}),e7(e,"after"),!0}return!!e.isTextBlock(n)&&"children"===t.path[1]&&3===t.path.length&&(r&&l?(e6(`Unsetting child at path ${JSON.stringify(l)}`),e7(e,"before"),e5&&e6(`Removing child at path ${JSON.stringify(l)}`),c.YR.removeNodes(e,{at:l}),e7(e,"after"),!0):(e6("Child not found"),!1))}(e,t);break;case"set":n=function(e,t){let n=t.value;"string"==typeof t.path[3]&&((n={})[t.path[3]]=t.value);let{block:i,blockPath:r,child:l,childPath:o}=te(e,t.path);if(!i)return e6("Block not found"),!1;let s=e.isTextBlock(i);if(s&&t.path.length>1&&"children"!==t.path[1])return e6("Ignoring setting void value"),!1;if(e7(e,"before"),s&&l&&o){if(c.xv.isText(n)&&c.xv.isText(l)){let t=l.text;n.text!==t&&(e6("Setting text property"),e.apply({type:"remove_text",path:o,offset:0,text:t}),e.apply({type:"insert_text",path:o,offset:0,text:n.text}),e.onChange())}else e6("Setting non-text property"),e.apply({type:"set_node",path:o,properties:{},newProperties:n});return!0}if(c.W_.isElement(i)&&1===t.path.length&&r){e6("Setting block property");let{children:t,...l}=n,{children:o,...s}=i||{children:void 0};e.apply({type:"set_node",path:r,properties:{...s},newProperties:l}),e6("Setting children"),i.children.forEach((t,n)=>{e.apply({type:"remove_node",path:r.concat(i.children.length-1-n),node:t})}),Array.isArray(t)&&t.forEach((t,n)=>{e.apply({type:"insert_node",path:r.concat(n),node:t})})}else if(i&&"value"in i){let n=(0,v.g7)([i.value],[t])[0];return c.YR.setNodes(e,{...i,value:n},{at:r}),!0}return e7(e,"after"),!0}(e,t);break;case"diffMatchPatch":n=function(e,t){let{block:n,child:i,childPath:r}=te(e,t.path);if(!n)return e6("Block not found"),!1;if(!i||!r)return e6("Child not found"),!1;if(!(n&&e.isTextBlock(n)&&4===t.path.length&&"children"===t.path[1]&&"text"===t.path[3])||!c.xv.isText(i))return!1;let[l]=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if("string"==typeof e)throw Error("Patches must be an array - pass the patch to `parsePatch()` first");let i=t;if(0===e.length)return[i,[]];let r=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=0,r=0;function l(e){for(;i<e;){let e=t.codePointAt(r);if(typeof e>"u")return r;i+=e1(e),e>65535?r+=2:r+=1}if(!n.allowExceedingIndices&&i!==e)throw Error("Failed to determine byte offset");return r}let o=[];for(let t of e)o.push({diffs:t.diffs.map(e=>eM(e)),start1:l(t.start1),start2:l(t.start2),utf8Start1:t.utf8Start1,utf8Start2:t.utf8Start2,length1:t.length1,length2:t.length2,utf8Length1:t.utf8Length1,utf8Length2:t.utf8Length2});return o}(e,i,{allowExceedingIndices:n.allowExceedingIndices}),l=n.margin||4,o=n.deleteThreshold||.4,s=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4,n="";for(let e=1;e<=t;e++)n+=String.fromCharCode(e);for(let n of e)n.start1+=t,n.start2+=t,n.utf8Start1+=t,n.utf8Start2+=t;let i=e[0],r=i.diffs;if(0===r.length||r[0][0]!==eW)r.unshift([eW,n]),i.start1-=t,i.start2-=t,i.utf8Start1-=t,i.utf8Start2-=t,i.length1+=t,i.length2+=t,i.utf8Length1+=t,i.utf8Length2+=t;else if(t>r[0][1].length){let e=r[0][1].length,l=t-e;r[0][1]=n.substring(e)+r[0][1],i.start1-=l,i.start2-=l,i.utf8Start1-=l,i.utf8Start2-=l,i.length1+=l,i.length2+=l,i.utf8Length1+=l,i.utf8Length2+=l}if(0===(r=(i=e[e.length-1]).diffs).length||r[r.length-1][0]!==eW)r.push([eW,n]),i.length1+=t,i.length2+=t,i.utf8Length1+=t,i.utf8Length2+=t;else if(t>r[r.length-1][1].length){let e=t-r[r.length-1][1].length;r[r.length-1][1]+=n.substring(0,e),i.length1+=e,i.length2+=e,i.utf8Length1+=e,i.utf8Length2+=e}return n}(r,l);i=s+i+s,function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4;for(let n=0;n<e.length;n++){if(e[n].length1<=32)continue;let i=e[n];e.splice(n--,1);let r=i.start1,l=i.start2,o="";for(;0!==i.diffs.length;){let s=eZ(r-o.length,l-o.length),a=!0;if(""!==o){let e=e0(o);s.length1=o.length,s.utf8Length1=e,s.length2=o.length,s.utf8Length2=e,s.diffs.push([eW,o])}for(;0!==i.diffs.length&&s.length1<32-t;){let e=i.diffs[0][0],n=i.diffs[0][1],o=e0(n);if(e===eF){s.length2+=n.length,s.utf8Length2+=o,l+=n.length;let e=i.diffs.shift();e&&s.diffs.push(e),a=!1}else e===ez&&1===s.diffs.length&&s.diffs[0][0]===eW&&n.length>64?(s.length1+=n.length,s.utf8Length1+=o,r+=n.length,a=!1,s.diffs.push([e,n]),i.diffs.shift()):(o=e0(n=n.substring(0,32-s.length1-t)),s.length1+=n.length,s.utf8Length1+=o,r+=n.length,e===eW?(s.length2+=n.length,s.utf8Length2+=o,l+=n.length):a=!1,s.diffs.push([e,n]),n===i.diffs[0][1]?i.diffs.shift():i.diffs[0][1]=i.diffs[0][1].substring(n.length))}o=(o=eQ(s.diffs)).substring(o.length-t);let c=eX(i.diffs).substring(0,t),h=e0(c);""!==c&&(s.length1+=c.length,s.length2+=c.length,s.utf8Length1+=h,s.utf8Length2+=h,0!==s.diffs.length&&s.diffs[s.diffs.length-1][0]===eW?s.diffs[s.diffs.length-1][1]+=c:s.diffs.push([eW,c])),a||e.splice(++n,0,s)}}}(r,l);let a=0,c=[];for(let e=0;e<r.length;e++){let t=r[e].start2+a,n=eX(r[e].diffs),l,s=-1;if(n.length>32?-1!==(l=eK(i,n.substring(0,32),t))&&(-1===(s=eK(i,n.substring(n.length-32),t+n.length-32))||l>=s)&&(l=-1):l=eK(i,n,t),-1===l)c[e]=!1,a-=r[e].length2-r[e].length1;else{let h;if(c[e]=!0,a=l-t,h=-1===s?i.substring(l,l+n.length):i.substring(l,s+32),n===h)i=i.substring(0,l)+eQ(r[e].diffs)+i.substring(l+n.length);else{let t=eG(n,h,{checkLines:!1});if(n.length>32&&function(e){let t=0,n=0,i=0;for(let r=0;r<e.length;r++){let l=e[r][0],o=e[r][1];switch(l){case eF:n+=o.length;break;case ez:i+=o.length;break;case eW:t+=Math.max(n,i),n=0,i=0;break;default:throw Error("Unknown diff operation.")}}return t+Math.max(n,i)}(t)/n.length>o)c[e]=!1;else{t=eI(t);let n=0,o=0;for(let s=0;s<r[e].diffs.length;s++){let a=r[e].diffs[s];a[0]!==eW&&(o=e2(t,n)),a[0]===eF?i=i.substring(0,l+o)+a[1]+i.substring(l+o):a[0]===ez&&(i=i.substring(0,l+o)+i.substring(l+e2(t,n+a[1].length))),a[0]!==ez&&(n+=a[1].length)}}}}}return[i=i.substring(s.length,i.length-s.length),c]}(e8(t.value),i.text,{allowExceedingIndices:!0}),o=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4,n=e.map(e=>eM(e)),i=!1,r=[],l=0,o=null,s=0,a=!1,c=!1,h=!1,d=!1;for(;s<n.length;)n[s][0]===eW?(n[s][1].length<t&&(h||d)?(r[l++]=s,a=h,c=d,o=n[s][1]):(l=0,o=null),h=!1,d=!1):(n[s][0]===ez?d=!0:h=!0,o&&(a&&c&&h&&d||o.length<t/2&&3===function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.reduce((e,t)=>e+(t?1:0),0)}(a,c,h,d))&&(n.splice(r[l-1],0,[ez,o]),n[r[l-1]+1][0]=eF,l--,o=null,a&&c?(h=!0,d=!0,l=0):(s=--l>0?r[l-1]:-1,h=!1,d=!1),i=!0)),s++;return i&&(n=eY(n)),n}(eG(i.text,l),5);e7(e,"before");let s=0;for(let[t,n]of o)t===eF?(e.apply({type:"insert_text",path:r,offset:s,text:n}),s+=n.length):t===ez?e.apply({type:"remove_text",path:r,offset:s,text:n}):t===eW&&(s+=n.length);return e7(e,"after"),!0}(e,t);break;default:e6("Unhandled patch",t.type)}}catch(e){console.error(e)}return n};return function(o){Z.set(o,!1),tt.set(o,!0),r=[...o.children];let{apply:s}=o,a=[],h=()=>{if(0===a.length)return;let e=a;a=[];let t=!1;e_(o,()=>{c.ML.withoutNormalizing(o,()=>{tn(o,()=>{tf(o,()=>{e.forEach(e=>{tg.enabled&&tg(`Handling remote patch ${JSON.stringify(e)}`),t=l(o,e)})})})}),t&&(o.normalize(),o.onChange())})},d=({patches:e})=>{let t=e.filter(e=>"local"!==e.origin);0!==t.length&&(a=a.concat(t),h())};return o.subscriptions.push(()=>{tg("Subscribing to remote patches");let t=e.on("patches",d);return()=>{tg("Unsubscribing to remote patches"),t.unsubscribe()}}),o.apply=l=>{if(n)return s(l),o;let a=[],c=K(r=o.children,i);s(l);let h=K(o.children,i);if(!tt.get(o))return o;switch(c&&!h&&"set_selection"!==l.type&&a.push((0,v.$T)(r,"before",[0])),l.type){case"insert_text":a=[...a,...t.insertTextPatch(o,l,r)];break;case"remove_text":a=[...a,...t.removeTextPatch(o,l,r)];break;case"remove_node":a=[...a,...t.removeNodePatch(o,l,r)];break;case"split_node":a=[...a,...t.splitNodePatch(o,l,r)];break;case"insert_node":a=[...a,...t.insertNodePatch(o,l,r)];break;case"set_node":a=[...a,...t.setNodePatch(o,l,r)];break;case"merge_node":a=[...a,...t.mergeNodePatch(o,l,r)];break;case"move_node":a=[...a,...t.moveNodePatch(o,l,r)]}return!c&&h&&["merge_node","set_node","remove_text","remove_node"].includes(l.type)&&(a=[...a,(0,v.zN)([])],e.send({type:"unset",previousValue:q(r,i.block.name,er.get(o))})),c&&a.length>0&&(a=[(0,v.Cb)([],[]),...a]),a.length>0&&a.forEach(t=>{e.send({type:"patch",patch:{...t,origin:"local"}})}),o},o}}({editorActor:a,patchFunctions:y,readOnly:p,schemaTypes:g}),S=(n=u||-1,function(e){let{apply:t}=e;return e.apply=i=>{if(eN(e)||eS(e)||eE(e)){t(i);return}n>0&&e.children.length>=n&&("insert_node"===i.type||"split_node"===i.type)&&1===i.path.length||t(i)},e}),E=function(e){return e.pteToggleListItem=t=>{e.pteHasListStyle(t)?(tk(`Remove list item '${t}'`),e.pteUnsetListItem(t)):(tk(`Add list item '${t}'`),e.pteSetListItem(t))},e.pteUnsetListItem=t=>{e.selection&&[...c.ML.nodes(e,{at:e.selection,match:e=>c.W_.isElement(e)&&e._type===g.block.name})].forEach(([n,i])=>{if(e.isListBlock(n)){let{listItem:r,level:l,...o}=n,s={...o,listItem:void 0,level:void 0};tk(`Unsetting list '${t}'`),c.YR.setNodes(e,s,{at:i})}})},e.pteSetListItem=t=>{e.selection&&[...c.ML.nodes(e,{at:e.selection,match:t=>e.isTextBlock(t)})].forEach(([n,i])=>{tk(`Setting list '${t}'`),c.YR.setNodes(e,{...n,level:1,listItem:t||g.lists[0]&&g.lists[0].value},{at:i})})},e.pteEndList=()=>{if(!e.selection)return!1;let t=[...c.ML.nodes(e,{at:e.selection,match:t=>c.W_.isElement(t)&&e.isListBlock(t)&&1===t.children.length&&c.xv.isText(t.children[0])&&""===t.children[0].text})];return 0!==t.length&&(t.forEach(([t,n])=>{c.W_.isElement(t)&&(tk("Unset list"),c.YR.setNodes(e,{...t,level:void 0,listItem:void 0},{at:n}))}),!0)},e.pteIncrementBlockLevels=t=>{if(!e.selection)return!1;let n=[...c.ML.nodes(e,{at:e.selection,match:t=>!!e.isListBlock(t)})];return 0!==n.length&&(n.forEach(([n,i])=>{if(e.isListBlock(n)){let r=n.level||1;t?tk("Decrementing list level",Math.min(10,Math.max(1,--r))):tk("Incrementing list level",Math.min(10,Math.max(1,++r))),c.YR.setNodes(e,{level:Math.min(10,Math.max(1,r))},{at:i})}}),!0)},e.pteHasListStyle=t=>{if(!e.selection)return!1;let n=[...c.ML.nodes(e,{at:e.selection,match:t=>e.isTextBlock(t)})];return n.length>0&&n.every(([n])=>e.isListBlock(n)&&n.listItem===t)},e},M=function(e){let{editorActor:t,readOnly:n,blockSchemaType:i}=e;return e=>{let r=q(e.children,i.name),l=ta(e);e.subscriptions.push(()=>{ti("Subscribing to patches");let n=t.on("patches",({patches:t,snapshot:n})=>{let i=!1;t.forEach(t=>{if(!i&&"local"!==t.origin&&l){if("unset"===t.type&&0===t.path.length){ti("Someone else cleared the content, resetting undo/redo history"),e.history={undos:[],redos:[]},l.splice(0,l.length),tl.set(e,!0),i=!0;return}l.push({patch:t,time:new Date,snapshot:n,previousSnapshot:r})}}),r=n});return()=>{ti("Unsubscribing to patches"),n.unsubscribe()}}),e.history={undos:[],redos:[]};let{apply:o}=e;return e.apply=t=>{if(n){o(t);return}let{operations:i,history:r}=e,{undos:l}=r,s=l[l.length-1],a=s&&s.operations&&s.operations[s.operations.length-1],c=tp(t,a),h=ts(e),d=!0;if(h){if(s?0===i.length&&(d=td(t,a)||c):d=!1,s&&d)s.operations.push(t);else{let n={operations:[...null===e.selection?[]:[{type:"set_selection",properties:{...e.selection},newProperties:{...e.selection}}],t],timestamp:new Date};l.push(n),ti("Created new undo step",s)}for(;l.length>1e3;)l.shift();tu(t)&&(r.redos=[])}o(t)},e.undo=()=>{if(n)return;let{undos:t}=e.history;if(t.length>0){let n=t[t.length-1];if(ti("Undoing",n),n.operations.length>0){let t=l.filter(e=>e.time>=n.timestamp),i=n.operations;t.forEach(t=>{i=w(i.map(n=>tc(e,t.patch,n,t.snapshot,t.previousSnapshot)))});let r=i.map(c.OX.inverse).reverse();try{c.ML.withoutNormalizing(e,()=>{(function(e,t){let n=eS(e);ew.set(e,!0),t(),ew.set(e,n)})(e,()=>{tf(e,()=>{r.forEach(t=>{e.apply(t)})})})}),e.normalize(),e.onChange()}catch(t){ti("Could not perform undo step",t),l.splice(0,l.length),c.YR.deselect(e),e.history={undos:[],redos:[]},tl.set(e,!0),ew.set(e,!1),e.onChange();return}e.history.redos.push(n),e.history.undos.pop()}}},e.redo=()=>{if(n)return;let{redos:t}=e.history;if(t.length>0){let n=t[t.length-1];if(ti("Redoing",n),n.operations.length>0){let t=l.filter(e=>e.time>=n.timestamp),i=n.operations;t.forEach(t=>{i=w(i.map(n=>tc(e,t.patch,n,t.snapshot,t.previousSnapshot)))});try{c.ML.withoutNormalizing(e,()=>{(function(e,t){let n=eE(e);eT.set(e,!0),t(),eT.set(e,n)})(e,()=>{tf(e,()=>{i.forEach(t=>{e.apply(t)})})})}),e.normalize(),e.onChange()}catch(t){ti("Could not perform redo step",t),l.splice(0,l.length),c.YR.deselect(e),e.history={undos:[],redos:[]},tl.set(e,!0),eT.set(e,!1),e.onChange();return}e.history.undos.push(n),e.history.redos.pop()}}},e}}({editorActor:a,readOnly:p,blockSchemaType:g.block}),A=function(e){let{apply:t,normalizeNode:n}=e,i=g.decorators.map(e=>e.value),r=()=>{e.selection&&(c.YR.select(e,{...e.selection}),e.selection={...e.selection});let t=W(e.children,e.selection,g);a.send({type:"selection",selection:t})};return e.normalizeNode=t=>{let[i,r]=t;if(e.isTextBlock(i))for(let[t,n]of c.NB.children(e,r)){let r=i.children[n[1]+1];if(e.isTextSpan(t)&&e.isTextSpan(r)&&t.marks?.every(e=>r.marks?.includes(e))&&r.marks?.every(e=>t.marks?.includes(e))){t_("Merging spans",JSON.stringify(t,null,2),JSON.stringify(r,null,2)),a.send({type:"normalizing"}),c.YR.mergeNodes(e,{at:[n[0],n[1]+1],voids:!0}),a.send({type:"done normalizing"});return}}if(e.isTextBlock(i)&&!Array.isArray(i.markDefs)){t_("Adding .markDefs to block node"),a.send({type:"normalizing"}),c.YR.setNodes(e,{markDefs:[]},{at:r}),a.send({type:"done normalizing"});return}if(e.isTextSpan(i)&&!Array.isArray(i.marks)){t_("Adding .marks to span node"),a.send({type:"normalizing"}),c.YR.setNodes(e,{marks:[]},{at:r}),a.send({type:"done normalizing"});return}if(e.isTextSpan(i)){let t=c.y$.parent(r),[n]=c.ML.node(e,t),l=g.decorators.map(e=>e.value),o=i.marks?.filter(e=>!l.includes(e));if(e.isTextBlock(n)&&""===i.text&&o&&o.length>0){t_("Removing annotations from empty span node"),a.send({type:"normalizing"}),c.YR.setNodes(e,{marks:i.marks?.filter(e=>l.includes(e))},{at:r}),a.send({type:"done normalizing"});return}}if(e.isTextBlock(i)){let t=g.decorators.map(e=>e.value);for(let[n,l]of c.NB.children(e,r))if(e.isTextSpan(n)){let r=n.marks??[],o=r.filter(e=>!t.includes(e)&&!i.markDefs?.find(t=>t._key===e));if(o.length>0){t_("Removing orphaned annotations from span node"),a.send({type:"normalizing"}),c.YR.setNodes(e,{marks:r.filter(e=>!o.includes(e))},{at:l}),a.send({type:"done normalizing"});return}}}if(e.isTextSpan(i)){let t=c.y$.parent(r),[n]=c.ML.node(e,t);if(e.isTextBlock(n)){let t=g.decorators.map(e=>e.value),l=i.marks??[],o=l.filter(e=>!t.includes(e)&&!n.markDefs?.find(t=>t._key===e));if(o.length>0){t_("Removing orphaned annotations from span node"),a.send({type:"normalizing"}),c.YR.setNodes(e,{marks:l.filter(e=>!o.includes(e))},{at:r}),a.send({type:"done normalizing"});return}}}if(e.isTextBlock(i)){let t=i.markDefs??[],n=new Set,l=[];for(let e of t)n.has(e._key)||(n.add(e._key),l.push(e));if(t.length!==l.length){t_("Removing duplicate markDefs"),a.send({type:"normalizing"}),c.YR.setNodes(e,{markDefs:l},{at:r}),a.send({type:"done normalizing"});return}}if(e.isTextBlock(i)&&!e.operations.some(e=>"merge_node"===e.type&&"markDefs"in e.properties&&1===e.path.length)){let t=(i.markDefs||[]).filter(e=>i.children.find(t=>c.xv.isText(t)&&Array.isArray(t.marks)&&t.marks.includes(e._key)));if(i.markDefs&&!o(t,i.markDefs)){t_("Removing markDef not in use"),a.send({type:"normalizing"}),c.YR.setNodes(e,{markDefs:t},{at:r}),a.send({type:"done normalizing"});return}}n(t)},e.apply=n=>{if(eN(e)||eS(e)||eE(e)){t(n);return}if("set_selection"===n.type&&c.ML.marks(e)&&n.properties&&n.newProperties&&n.properties.anchor&&n.properties.focus&&n.newProperties.anchor&&n.newProperties.focus){let t=c.e6.isCollapsed({anchor:n.properties.anchor,focus:n.properties.focus}),i=c.e6.isCollapsed({anchor:n.newProperties.anchor,focus:n.newProperties.focus});if(t&&i){let t=Array.from(c.ML.nodes(e,{mode:"lowest",at:n.properties.focus,match:t=>e.isTextSpan(t),voids:!1}))[0]?.[0],i=Array.from(c.ML.nodes(e,{mode:"lowest",at:n.newProperties.focus,match:t=>e.isTextSpan(t),voids:!1}))[0]?.[0],r=t&&i&&n.newProperties.focus.path[0]===n.properties.focus.path[0]&&n.newProperties.focus.path[1]===n.properties.focus.path[1]+1&&t.text.length===n.properties.focus.offset&&0===n.newProperties.focus.offset,l=t&&i&&n.newProperties.focus.path[0]===n.properties.focus.path[0]&&n.newProperties.focus.path[1]===n.properties.focus.path[1]-1&&0===n.properties.focus.offset&&i.text.length===n.newProperties.focus.offset;if(r||l)return}}if("insert_node"===n.type){let{selection:t}=e;if(t){let[r,l]=c.ML.node(e,t,{depth:1}),o=tv({editor:e,blockPath:l,spanPath:n.path}),s=o?o.marks?.filter(e=>!i.includes(e)):[],a=tx({editor:e,blockPath:l,spanPath:[n.path[0],n.path[1]-1]}),h=a?a.marks?.filter(e=>!i.includes(e)):[],d=s?.filter(e=>!h?.includes(e))??[],p=d.length>0;if(p&&tb(n.node)&&n.node.marks?.some(e=>d.includes(e))){c.YR.insertNodes(e,{...n.node,marks:n.node.marks?.filter(e=>!d.includes(e))??[]});return}let u=h?.filter(e=>!s?.includes(e))??[],f=u.length>0;if(f&&tb(n.node)&&n.node.marks?.some(e=>u.includes(e))){c.YR.insertNodes(e,{...n.node,marks:n.node.marks?.filter(e=>!u.includes(e))??[]});return}let g=a?.marks?.filter(e=>i.includes(e))??[];if(g.length>0&&p&&!f&&tb(n.node)&&n.node.marks?.length===0){c.YR.insertNodes(e,{...n.node,marks:g});return}}}if("insert_text"===n.type){let{selection:r}=e,l=!!r&&c.e6.isCollapsed(r);if(r&&l){let[l,o]=c.ML.node(e,r,{depth:1}),[s,h]=Array.from(c.ML.nodes(e,{mode:"lowest",at:r.focus,match:t=>e.isTextSpan(t),voids:!1}))[0]??[void 0,void 0],d=s.marks??[],p=d.filter(e=>i.includes(e)),u=d.length>p.length,f=0===s.text.length,g=0===r.anchor.offset,y=r.anchor.offset===s.text.length,m=tv({editor:e,blockPath:o,spanPath:h}),k=tx({editor:e,blockPath:o,spanPath:h}),b=k?.marks?.filter(e=>!i.includes(e))??[],v=d.filter(e=>!i.includes(e)),x=!!m&&m.marks?.some(e=>!i.includes(e)),_=!!m&&m.marks?.filter(e=>!i.includes(e)).every(e=>d.includes(e)),N=!!m&&m.marks?.some(e=>!i.includes(e)&&d.includes(e)),w=!!m&&m.marks?.every(e=>d.includes(e)),T=v.some(e=>b?.includes(e));if(u&&!f){if(g){if(w||_){c.YR.insertNodes(e,{_type:"span",_key:a.getSnapshot().context.keyGenerator(),text:n.text,marks:m?.marks??[]});return}if(N){t(n);return}if(!m){c.YR.insertNodes(e,{_type:"span",_key:a.getSnapshot().context.keyGenerator(),text:n.text,marks:[]});return}}if(y){if(k&&T&&b.length<v.length||!T){c.YR.insertNodes(e,{_type:"span",_key:a.getSnapshot().context.keyGenerator(),text:n.text,marks:k?.marks??[]});return}if(!k){c.YR.insertNodes(e,{_type:"span",_key:a.getSnapshot().context.keyGenerator(),text:n.text,marks:[]});return}}}if(g&&!f&&m){c.YR.insertNodes(e,{_type:"span",_key:a.getSnapshot().context.keyGenerator(),text:n.text,marks:x?[]:(m.marks??[]).filter(e=>i.includes(e))});return}}}if("remove_text"===n.type){let{selection:l}=e;if(l&&c.e6.isExpanded(l)){var r;let[o,s]=c.ML.node(e,l,{depth:1}),[a,h]=Array.from(c.ML.nodes(e,{mode:"lowest",at:{path:n.path,offset:n.offset},match:t=>e.isTextSpan(t),voids:!1}))[0]??[void 0,void 0];if(a&&o&&"string"==typeof(r=o)._type&&"@"!==r._type[0]&&(!("markDefs"in r)||!r.markDefs||Array.isArray(r.markDefs)&&r.markDefs.every(e=>"string"==typeof e._key))&&"children"in r&&Array.isArray(r.children)&&r.children.every(e=>"object"==typeof e&&"_type"in e)){let r=o.markDefs??[],l=a.marks??[],d=l.some(e=>r.find(t=>t._key===e)),p=n.offset+n.text.length===a.text.length,u=0===n.offset&&p,f=tv({editor:e,blockPath:s,spanPath:h}),g=tx({editor:e,blockPath:s,spanPath:h}),y=!!f&&f.marks?.some(e=>!i.includes(e)&&l.includes(e)),m=!!g&&g.marks?.some(e=>!i.includes(e)&&l.includes(e));if(d&&u&&!y&&!m){let r=(({...c.ML.marks(e)||{}}).marks||[]).filter(e=>i.includes(e));c.ML.withoutNormalizing(e,()=>{t(n),c.YR.setNodes(e,{marks:r},{at:n.path})}),e.onChange();return}}}}if("merge_node"===n.type&&1===n.path.length&&"markDefs"in n.properties&&n.properties._type===g.block.name&&Array.isArray(n.properties.markDefs)&&n.properties.markDefs.length>0&&n.path[0]-1>=0){let[i,r]=c.ML.node(e,[n.path[0]-1]);if(e.isTextBlock(i)){let l=f([...Array.isArray(i.markDefs)&&i.markDefs||[],...n.properties.markDefs]);t_("Copying markDefs over to merged block",n),c.YR.setNodes(e,{markDefs:l},{at:r,voids:!1}),t(n);return}}t(n)},e.addMark=t=>{if(e.selection){if(c.e6.isExpanded(e.selection))c.ML.withoutNormalizing(e,()=>{c.YR.setNodes(e,{},{match:c.xv.isText,split:!0,hanging:!0});let n=c.e6.isRange(e.selection)?[...c.ML.nodes(e,{at:e.selection,match:c.xv.isText})]:[];n.length>1&&n.every(e=>e[0].marks?.includes(t))?e.removeMark(t):n.forEach(([n,i])=>{let r=[...(Array.isArray(n.marks)?n.marks:[]).filter(e=>e!==t),t];c.YR.setNodes(e,{marks:r},{at:i,match:c.xv.isText,split:!0,hanging:!0})})});else{let[n,i]=c.ML.node(e,e.selection,{depth:1}),l=e.isTextBlock(n)&&1===n.children.length&&e.isTextSpan(n.children[0])&&""===n.children[0].text?n.children[0]:void 0;if(l){let n=l.marks??[],r=n.filter(e=>e!==t);c.YR.setNodes(e,{marks:n.length===r.length?[...n,t]:r},{at:i,match:t=>e.isTextSpan(t)})}else{let n={...c.ML.marks(e)||{}}.marks||[],i={...c.ML.marks(e)||{},marks:[...n,t]};return e.marks=i,r(),e}}e.onChange(),r()}return e},e.removeMark=t=>{let{selection:n}=e;if(n){if(c.e6.isExpanded(n))c.ML.withoutNormalizing(e,()=>{c.YR.setNodes(e,{},{match:c.xv.isText,split:!0,hanging:!0}),e.selection&&[...c.ML.nodes(e,{at:e.selection,match:c.xv.isText})].forEach(([n,i])=>{let r=e.children[i[0]];c.W_.isElement(r)&&r.children.includes(n)&&c.YR.setNodes(e,{marks:(Array.isArray(n.marks)?n.marks:[]).filter(e=>e!==t),_type:"span"},{at:i})})}),c.ML.normalize(e);else{let[i,l]=c.ML.node(e,n,{depth:1}),o=e.isTextBlock(i)&&1===i.children.length&&e.isTextSpan(i.children[0])&&""===i.children[0].text?i.children[0]:void 0;if(o){let n=(o.marks??[]).filter(e=>e!==t);c.YR.setNodes(e,{marks:n},{at:l,match:t=>e.isTextSpan(t)})}else{let n={...c.ML.marks(e)||{}}.marks||[],i={...c.ML.marks(e)||{},marks:n.filter(e=>e!==t)};return e.marks={marks:i.marks,_type:"span"},r(),e}}e.onChange(),r()}return e},e.pteIsMarkActive=t=>{if(!e.selection)return!1;let n=Array.from(c.ML.nodes(e,{match:c.xv.isText,at:e.selection}));return c.e6.isExpanded(e.selection)?n.every(e=>{let[n]=e;return n.marks?.includes(t)}):(({...c.ML.marks(e)||{}}).marks||[]).includes(t)},e.pteToggleMark=t=>{e.pteIsMarkActive(t)?(t_(`Remove mark '${t}'`),c.ML.removeMark(e,t)):(t_(`Add mark '${t}'`),c.ML.addMark(e,t,!0))},e},R=function(e,t){let n=t.styles[0].value;return function(t){let{normalizeNode:i}=t;return t.normalizeNode=r=>{let[,l]=r;for(let i of t.operations)if("split_node"===i.type&&1===i.path.length&&t.isTextBlock(i.properties)&&i.properties.style!==n&&i.path[0]===l[0]&&!c.y$.equals(l,i.path)){let[r]=c.ML.node(t,[i.path[0]+1,0]);if(c.xv.isText(r)&&""===r.text){tm(`Normalizing split node to ${n} style`,i),e.send({type:"normalizing"}),c.YR.setNodes(t,{style:n},{at:[i.path[0]+1],voids:!1}),e.send({type:"done normalizing"});return}}i(r)},t.pteHasBlockStyle=e=>!!t.selection&&[...c.ML.nodes(t,{at:t.selection,match:n=>t.isTextBlock(n)&&n.style===e})].length>0,t.pteToggleBlockStyle=e=>{t.selection&&([...c.ML.nodes(t,{at:t.selection,match:e=>t.isTextBlock(e)})].forEach(([i,r])=>{t.isTextBlock(i)&&i.style===e?(tm(`Unsetting block style '${e}'`),c.YR.setNodes(t,{...i,style:n},{at:r})):(e?tm(`Setting style '${e}'`):tm("Setting default style",n),c.YR.setNodes(t,{...i,style:e||n},{at:r}))}),t.onChange())},t}}(a,g),L=function(e){let{apply:t}=e;return e.apply=n=>{if(eN(e)||eS(e)||eE(e)){t(n);return}if("remove_node"===n.type){let t=n.node;if(0===n.path[0]&&c.ML.isVoid(e,t)){let t=c.y$.next(n.path);e.children[t[0]]||(ty("Adding placeholder block"),c.ML.insertNode(e,e.pteCreateTextBlock({decorators:[]})))}}t(n)},e},C=function({editorActor:e,schemaTypes:t,portableTextEditor:n}){return function(i){return i.pteExpandToWord=()=>{let{selection:e}=i;if(e&&!c.e6.isExpanded(e)){let[t]=c.ML.node(i,e.focus,{depth:2});if(!t||!c.xv.isText(t)||0===t.text.length){tS("pteExpandToWord: Can't expand to word here");return}let{focus:n}=e,r=n.offset,l=t.text.slice(0,r),o=t.text.slice(r,-1),s=e=>e.match(/\s/g),a=l.split("").reverse().findIndex(e=>s(e)),h=a>-1?l.length-a:0,d=o.split("").findIndex(e=>s(e)),p=l.length+(d>-1?d:o.length+1);if(!(h===p||Number.isNaN(h)||Number.isNaN(p))){tS("pteExpandToWord: Expanding to focused word"),c.YR.setSelection(i,{anchor:{...e.anchor,offset:h},focus:{...e.focus,offset:p}});return}tS("pteExpandToWord: Can't expand to word here")}},i.pteCreateTextBlock=i=>U([{_type:t.block.name,_key:e.getSnapshot().context.keyGenerator(),style:t.styles[0].value||"normal",...i.listItem?{listItem:i.listItem}:{},...i.level?{level:i.level}:{},markDefs:[],children:[{_type:"span",_key:e.getSnapshot().context.keyGenerator(),text:"",marks:i.decorators.filter(e=>t.decorators.find(({value:t})=>t===e))}]}],n)[0],i}}({editorActor:a,schemaTypes:g,portableTextEditor:d}),B=(l=null,function(e){let t=()=>{if(l!==e.selection){let t=null;if(e.selection){let n=el.get(e.selection);n?t=n:(t=W(e.children,e.selection,g),el.set(e.selection,t))}tw&&tN(`Emitting selection ${JSON.stringify(t||null)} (${JSON.stringify(e.selection)})`),t?a.send({type:"selection",selection:t}):a.send({type:"selection",selection:null})}l=e.selection},{onChange:n}=e;return e.onChange=()=>{let i=e.operations.length>0;n(),i&&t()},e});return e.destroy=()=>{let t=tB.get(e);if(!t)throw Error("Could not find pristine versions of editor functions");e.apply=t.apply,e.history={undos:[],redos:[]},e.normalizeNode=t.normalizeNode,e.onChange=t.onChange},p?{editor:k(m(A(R(C(L(E(B(b(e))))))))),subscribe:()=>s}:{editor:((r=k(m(A(R(E(L(C(S(M(T(B(b(e))))))))))))).deleteBackward=e=>{a.send({type:"behavior event",behaviorEvent:{type:"delete backward",unit:e},editor:r})},r.deleteForward=e=>{a.send({type:"behavior event",behaviorEvent:{type:"delete forward",unit:e},editor:r})},r.insertBreak=()=>{a.send({type:"behavior event",behaviorEvent:{type:"insert break"},editor:r})},r.insertSoftBreak=()=>{a.send({type:"behavior event",behaviorEvent:{type:"insert soft break"},editor:r})},r.insertText=(e,t)=>{a.send({type:"behavior event",behaviorEvent:{type:"insert text",text:e,options:t},editor:r})},r),subscribe:()=>{let t=[];return e.subscriptions.forEach(e=>{t.push(e())}),()=>{t.forEach(e=>{e()})}}}},t$=O("component:PortableTextEditor:SlateContainer");function tP(e){let t,n,i,r,o,s,d,u,f,g,y;let m=(0,p.c)(26),{editorActor:k,portableTextEditor:b,readOnly:v,maxBlocks:x}=e;m[0]!==k||m[1]!==x||m[2]!==b||m[3]!==v?(t=()=>{t$("Creating new Slate editor instance");let{editor:e,subscribe:t}=tD((0,h.BU)((0,c.Jh)()),{editorActor:k,maxBlocks:x,portableTextEditor:b,readOnly:v});return er.set(e,{}),ei.set(e,{}),[e,t]},m[0]=k,m[1]=x,m[2]=b,m[3]=v,m[4]=t):t=m[4];let[_]=(0,a.useState)(t),[N,w]=_;return m[5]!==w?(n=()=>{let e=w();return()=>{e()}},i=[w],m[5]=w,m[6]=n,m[7]=i):(n=m[6],i=m[7]),(0,a.useEffect)(n,i),m[8]!==N||m[9]!==k||m[10]!==x||m[11]!==b||m[12]!==v?(r=()=>{t$("Re-initializing plugin chain"),tD(N,{editorActor:k,maxBlocks:x,portableTextEditor:b,readOnly:v})},o=[k,b,x,v,N],m[8]=N,m[9]=k,m[10]=x,m[11]=b,m[12]=v,m[13]=r,m[14]=o):(r=m[13],o=m[14]),(0,a.useEffect)(r,o),m[15]!==N?(d=N.pteCreateTextBlock({decorators:[]}),m[15]=N,m[16]=d):d=m[16],m[17]!==d?(u=[d],m[17]=d,m[18]=u):u=m[18],s=u,m[19]!==N?(f=()=>()=>{t$("Destroying Slate editor"),N.destroy()},g=[N],m[19]=N,m[20]=f,m[21]=g):(f=m[20],g=m[21]),(0,a.useEffect)(f,g),m[22]!==N||m[23]!==s||m[24]!==e.children?(y=(0,l.jsx)(h.mH,{editor:N,initialValue:s,children:e.children}),m[22]=N,m[23]=s,m[24]=e.children,m[25]=y):y=m[25],y}tP.displayName="SlateContainer";let tI=(0,a.createContext)(!1),tY=()=>{let e=(0,a.useContext)(tI);if(void 0===e)throw Error("The `usePortableTextEditorReadOnly` hook must be used inside the <PortableTextEditor> component's context.");return e},tj=O("hook:useSyncValue"),tO=new WeakMap,tz=O("component:PortableTextEditor:Synchronizer"),tF=tz.enabled&&!1;function tW(e){let t,n,i,r,l,s,d,u,f,g,y,m,k,b,v;let x=(0,p.c)(35),_=em(),N=tY(),{editorActor:w,getValue:T,onChange:S,value:E}=e;x[0]===Symbol.for("react.memo_cache_sentinel")?(t=[],x[0]=t):t=x[0];let L=(0,a.useRef)(t);x[1]!==w||x[2]!==_||x[3]!==N?(n={editorActor:w,portableTextEditor:_,readOnly:N},x[1]=w,x[2]=_,x[3]=N,x[4]=n):n=x[4];let C=function(e){let{editorActor:t,portableTextEditor:n,readOnly:i}=e,r=t.getSnapshot().context.schema,l=(0,a.useRef)(),s=(0,h.ui)(),d=(0,a.useRef)(),p=(0,a.useCallback)(()=>{let e=tO.get(n);if(l.current===e){tj("Value is the same object as previous, not need to sync");return}d.current&&e&&(tj("Updating the value debounced"),d.current(e))},[n]),u=(0,a.useMemo)(()=>R(p,1e3,{trailing:!0,leading:!1}),[p]);return(0,a.useMemo)(()=>{let e=e=>{tO.set(n,e);let a=X.get(s),h=eN(s);if(!i){if(a){tj("Has local changes, not syncing value right now"),u();return}if(h){tj("Has remote changes, not syncing value right now"),u();return}}let d=!1,p=!0,f=!!s.selection;if(e&&0!==e.length||(tj("Value is empty"),c.ML.withoutNormalizing(s,()=>{tf(s,()=>{tn(s,()=>{f&&c.YR.deselect(s);let e=s.children.length;s.children.forEach((t,n)=>{c.YR.removeNodes(s,{at:[e-1-n]})}),c.YR.insertNodes(s,s.pteCreateTextBlock({decorators:[]}),{at:[0]}),f&&c.YR.select(s,[0,0])})})}),d=!0),e&&e.length>0){let n=U(e,{schemaTypes:r});c.ML.withoutNormalizing(s,()=>{e_(s,()=>{tf(s,()=>{tn(s,()=>{let a=s.children.length;if(n.length<a){for(let e=a-1;e>n.length-1;e--)c.YR.removeNodes(s,{at:[e]});d=!0}n.forEach((n,a)=>{let h=s.children[a];if(h&&!o(n,h)&&p){let u=[e[a]],f=tA(u,r,t.getSnapshot().context.keyGenerator);!f.valid&&f.resolution?.autoResolve&&f.resolution?.patches.length>0&&!i&&l.current&&l.current!==e&&(console.warn(`${f.resolution.action} for block with _key '${u[0]._key}'. ${f.resolution?.description}`),f.resolution.patches.forEach(e=>{t.send({type:"patch",patch:e})})),f.valid||f.resolution?.autoResolve?(h._key===n._key?(tj.enabled&&tj("Updating block",h,n),function(e,t,n,i){if(c.YR.setNodes(e,t,{at:[i]}),e.isTextBlock(t)&&e.isTextBlock(n)){let r=n.children.length;t.children.length<r&&Array.from(Array(r-t.children.length)).forEach((t,n)=>{let l=r-1-n;l>0&&(tj("Removing child"),c.YR.removeNodes(e,{at:[i,l]}))}),t.children.forEach((t,r)=>{let l=n.children[r],s=!o(t,l),a=!o(t.text,l?.text),h=[i,r];if(s){if(t._key===l?._key){tj("Updating changed child",t,l),c.YR.setNodes(e,t,{at:h});let n=c.xv.isText(t)&&"span"===t._type&&c.xv.isText(l)&&"span"===l._type;n&&a?(c.YR.delete(e,{at:{focus:{path:h,offset:0},anchor:{path:h,offset:l.text.length}}}),c.YR.insertText(e,t.text,{at:h}),e.onChange()):n||(tj("Updating changed inline object child",t),c.YR.setNodes(e,{_key:V},{at:[...h,0],voids:!0}))}else l?(tj("Replacing child",t),c.YR.removeNodes(e,{at:[i,r]}),c.YR.insertNodes(e,t,{at:[i,r]}),e.onChange()):l||(tj("Inserting new child",t),c.YR.insertNodes(e,t,{at:[i,r]}),e.onChange())}})}}(s,n,h,a)):(tj.enabled&&tj("Replacing block",h,n),function(e,t,n){let i=e.selection,r=i&&i.focus.path[0]===n;r&&c.YR.deselect(e),c.YR.removeNodes(e,{at:[n]}),c.YR.insertNodes(e,t,{at:[n]}),e.onChange(),r&&c.YR.select(e,i)}(s,n,a)),d=!0):(t.send({type:"invalid value",resolution:f.resolution,value:e}),p=!1)}if(!h&&p){let i=tA([e[a]],r,t.getSnapshot().context.keyGenerator);tj.enabled&&tj("Validating and inserting new block in the end of the value",n),i.valid||i.resolution?.autoResolve?c.YR.insertNodes(s,n,{at:[a]}):(tj("Invalid",i),t.send({type:"invalid value",resolution:i.resolution,value:e}),p=!1)}})})})})})}if(!p){tj("Invalid value, returning");return}if(d){tj("Server value changed, syncing editor");try{s.onChange()}catch(n){console.error(n),t.send({type:"invalid value",resolution:null,value:e});return}f&&!s.selection&&(c.YR.select(s,{anchor:{path:[0,0],offset:0},focus:{path:[0,0],offset:0}}),s.onChange()),t.send({type:"value changed",value:e})}else tj("Server value and editor value is equal, no need to sync.");l.current=e};return d.current=e,e},[t,n,i,r,s,u])}(n),B=(0,h.ui)();x[5]!==B?(i=()=>{X.set(B,!1)},r=[B],x[5]=B,x[6]=i,x[7]=r):(i=x[6],r=x[7]),(0,a.useEffect)(i,r),x[8]!==T||x[9]!==w||x[10]!==B?(l=()=>{if(L.current.length>0){tz("Flushing pending patches"),tF&&tz(`Patches:
${JSON.stringify(L.current,null,2)}`);let e=T();w.send({type:"mutation",patches:L.current,snapshot:e}),L.current=[]}X.set(B,!1)},x[8]=T,x[9]=w,x[10]=B,x[11]=l):l=x[11];let D=l;x[12]!==D?(s=()=>()=>{D()},d=[D],x[12]=D,x[13]=s,x[14]=d):(s=x[13],d=x[14]),(0,a.useEffect)(s,d),x[15]!==S?(u=e=>S(e),x[15]=S,x[16]=u):u=x[16];let $=(0,A.i)(u);x[17]!==B||x[18]!==D||x[19]!==w||x[20]!==$?(f=()=>{let e=M(()=>{if(c.ML.isNormalizing(B)){D();return}e()},1e3,{leading:!1,trailing:!0});tz("Subscribing to editor changes");let t=w.on("*",t=>{switch(t.type){case"patch":X.set(B,!0),L.current.push(t.patch),e(),$(t);break;case"loading":$({type:"loading",isLoading:!0});break;case"done loading":$({type:"loading",isLoading:!1});break;case"offline":$({type:"connection",value:"offline"});break;case"online":$({type:"connection",value:"online"});break;case"value changed":$({type:"value",value:t.value});break;case"invalid value":$({type:"invalidValue",resolution:t.resolution,value:t.value});break;case"error":$({...t,level:"warning"});break;case"patches":break;default:$(t)}});return()=>{tz("Unsubscribing to changes"),t.unsubscribe()}},g=[w,$,D,B],x[17]=B,x[18]=D,x[19]=w,x[20]=$,x[21]=f,x[22]=g):(f=x[21],g=x[22]),(0,a.useEffect)(f,g),x[23]!==C||x[24]!==E?(y=()=>{tz("Editor is online, syncing from props.value"),C(E)},x[23]=C,x[24]=E,x[25]=y):y=x[25];let P=y;x[26]!==w||x[27]!==P?(m=()=>{let e=w.on("online",P);return()=>{e.unsubscribe()}},k=[P,w],x[26]=w,x[27]=P,x[28]=m,x[29]=k):(m=x[28],k=x[29]),(0,a.useEffect)(m,k);let I=(0,a.useRef)(!0);return x[30]!==C||x[31]!==E||x[32]!==w?(b=()=>{tz("Value from props changed, syncing new value"),C(E),I.current&&(w.send({type:"ready"}),I.current=!1)},v=[w,C,E],x[30]=C,x[31]=E,x[32]=w,x[33]=b,x[34]=v):(b=x[33],v=x[34]),(0,a.useEffect)(b,v),null}tW.displayName="Synchronizer";let tG=(0,a.createContext)({}),tJ=({context:e,action:t})=>{let n=e.keyGenerator,i=e.schema,r=t.editor;if(!r.selection)return;let[l]=Array.from(c.ML.nodes(r,{mode:"lowest",at:r.selection.focus,match:e=>r.isTextSpan(e),voids:!1}))[0]??[void 0],s=l.marks?.filter(e=>i.decorators.some(t=>t.value===e))??[],a=l.marks?.filter(e=>!i.decorators.some(t=>t.value===e))??[],h=r.selection.focus.path.slice(0,1),d=c.NB.descendant(r,h);if(r.isTextBlock(d)){let[e,t]=c.e6.edges(r.selection),l=o(t,{path:[...h,0],offset:0});if(l&&c.e6.isCollapsed(r.selection)){c.ML.insertNode(r,r.pteCreateTextBlock({decorators:0===a.length?s:[],listItem:d.listItem,level:d.level}));let[e]=c.y$.next(h);c.YR.select(r,{anchor:{path:[e,0],offset:0},focus:{path:[e,0],offset:0}});return}let p=d.children[d.children.length-1],u=o(e,{path:[...h,d.children.length-1],offset:r.isTextSpan(p)?p.text.length:0});if(u&&c.e6.isCollapsed(r.selection)){c.ML.insertNode(r,r.pteCreateTextBlock({decorators:[],listItem:d.listItem,level:d.level}));let[e]=c.y$.next(h);c.YR.setSelection(r,{anchor:{path:[e,0],offset:0},focus:{path:[e,0],offset:0}});return}if(!l&&!u){c.ML.withoutNormalizing(r,()=>{if(!r.selection)return;c.YR.splitNodes(r,{at:r.selection});let[e,t]=c.ML.node(r,c.y$.next(h),{depth:1});if(c.YR.setSelection(r,{anchor:{path:[...t,0],offset:0},focus:{path:[...t,0],offset:0}}),r.isTextBlock(e)&&e.markDefs&&e.markDefs.length>0){let l=new Map,s=Array.from(c.NB.children(r,h)).map(e=>e[0]).filter(e=>r.isTextSpan(e));for(let[e,a]of c.NB.children(r,t)){if(!r.isTextSpan(e))continue;let t=e.marks??[];for(let e of t)i.decorators.some(t=>t.value===e)||s.some(t=>t.marks?.includes(e))&&!l.has(e)&&l.set(e,n());let h=t.map(e=>l.get(e)??e);o(t,h)||c.YR.setNodes(r,{marks:h},{at:a})}let a=e.markDefs.map(e=>({...e,_key:l.get(e._key)??e._key}));o(e.markDefs,a)||c.YR.setNodes(r,{markDefs:a},{at:t,match:e=>r.isTextBlock(e)})}}),r.onChange();return}}},tV={"set block":({action:e})=>{for(let t of e.paths){let n=G({anchor:{path:t,offset:0},focus:{path:t,offset:0}},e.editor);c.YR.setNodes(e.editor,{...e.style?{style:e.style}:{},...e.listItem?{listItem:e.listItem}:{},...e.level?{level:e.level}:{}},{at:n})}},"unset block":({action:e})=>{for(let t of e.paths){let n=G({anchor:{path:t,offset:0},focus:{path:t,offset:0}},e.editor);c.YR.unsetNodes(e.editor,e.props,{at:n})}},"delete backward":({action:e})=>{(0,c.j)(e.editor,e.unit)},"delete forward":({action:e})=>{(0,c.Kb)(e.editor,e.unit)},delete:({action:e})=>{let t=G(e.selection,e.editor);if(!t){console.error(`Could not find Slate location from selection ${e.selection}`);return}1===t.anchor.path.length&&1===t.focus.path.length?c.YR.removeNodes(e.editor,{at:t}):c.YR.delete(e.editor,{at:t})},"insert break":tJ,"insert soft break":tJ,"insert text":({action:e})=>{(0,c.Om)(e.editor,e.text)},"insert text block":({context:e,action:t})=>{c.ML.insertNode(t.editor,{_key:e.keyGenerator(),_type:e.schema.block.name,style:e.schema.styles[0].value??"normal",markDefs:[],children:[{_key:e.keyGenerator(),_type:"span",text:""}]})},effect:({action:e})=>{e.effect()},select:({action:e})=>{c.YR.select(e.editor,G(e.selection,e.editor))}};function tH({context:e,action:t}){switch(t.type){case"delete backward":tV["delete backward"]({context:e,action:t});break;case"delete forward":tV["delete forward"]({context:e,action:t});break;case"insert break":tV["insert break"]({context:e,action:t});break;case"insert soft break":tV["insert soft break"]({context:e,action:t});break;default:tV["insert text"]({context:e,action:t})}}let tU=(0,y.E9)(({sendBack:e})=>{let t=()=>{e({type:"online"})},n=()=>{e({type:"offline"})};return window.addEventListener("online",t),window.addEventListener("offline",n),()=>{window.removeEventListener("online",t),window.removeEventListener("offline",n)}}),tq=(0,m.cY)({types:{context:{},events:{},emitted:{},input:{}},actions:{"assign behaviors":(0,k.a)({behaviors:({event:e})=>((0,m.ZD)(e,"update behaviors"),e.behaviors)}),"assign schema":(0,k.a)({schema:({event:e})=>((0,m.ZD)(e,"update schema"),e.schema)}),"emit patch event":(0,k.e)(({event:e})=>((0,m.ZD)(e,"patch"),e)),"emit mutation event":(0,k.e)(({event:e})=>((0,m.ZD)(e,"mutation"),e)),"defer event":(0,k.a)({pendingEvents:({context:e,event:t})=>((0,m.ZD)(t,["patch","mutation"]),[...e.pendingEvents,t])}),"emit pending events":(0,k.b)(({context:e,enqueue:t})=>{for(let n of e.pendingEvents)t((0,k.e)(n))}),"clear pending events":(0,k.a)({pendingEvents:[]}),"handle behavior event":(0,k.b)(({context:e,event:t,enqueue:n})=>{(0,m.ZD)(t,["behavior event"]);let i={...t.behaviorEvent,editor:t.editor},r=e.behaviors.filter(e=>e.on===t.behaviorEvent.type);if(0===r.length){tH({context:e,action:i});return}let l=q(t.editor.children,e.schema.block.name,er.get(t.editor)),o=W(l,t.editor.selection,e.schema);if(!o){console.warn(`Unable to handle event ${t.type} due to missing selection`),tH({context:e,action:i});return}let s={schema:e.schema,value:l,selection:o},a=!1;for(let e of r){let i=e.guard?.({context:s,event:t.behaviorEvent})??!0;if(i){for(let r of e.actions.map(e=>e({context:s,event:t.behaviorEvent},i)))a=r.length>0&&r.some(e=>"effect"!==e.type),n.raise({type:"behavior action intends",editor:t.editor,actionIntends:r});if(a)break}}a||tH({context:e,action:i})})},actors:{networkLogic:tU}}).createMachine({id:"editor",context:({input:e})=>({behaviors:e.behaviors??I,keyGenerator:e.keyGenerator,pendingEvents:[],schema:e.schema}),invoke:{id:"networkLogic",src:"networkLogic"},on:{ready:{actions:(0,k.e)(({event:e})=>e)},unset:{actions:(0,k.e)(({event:e})=>e)},"value changed":{actions:(0,k.e)(({event:e})=>e)},"invalid value":{actions:(0,k.e)(({event:e})=>e)},error:{actions:(0,k.e)(({event:e})=>e)},selection:{actions:(0,k.e)(({event:e})=>e)},blur:{actions:(0,k.e)(({event:e})=>e)},focus:{actions:(0,k.e)(({event:e})=>e)},online:{actions:(0,k.e)({type:"online"})},offline:{actions:(0,k.e)({type:"offline"})},loading:{actions:(0,k.e)({type:"loading"})},patches:{actions:(0,k.e)(({event:e})=>e)},"done loading":{actions:(0,k.e)({type:"done loading"})},"update behaviors":{actions:"assign behaviors"},"update schema":{actions:"assign schema"},"behavior event":{actions:"handle behavior event"},"behavior action intends":{actions:[({context:e,event:t})=>{c.ML.withoutNormalizing(t.editor,()=>{for(let n of t.actionIntends)(function({context:e,action:t}){switch(t.type){case"delete":tV.delete({context:e,action:t});break;case"insert text block":tV["insert text block"]({context:e,action:t});break;case"set block":tV["set block"]({context:e,action:t});break;case"unset block":tV["unset block"]({context:e,action:t});break;case"effect":tV.effect({context:e,action:t});break;case"select":tV.select({context:e,action:t});break;default:tH({context:e,action:t})}})({context:e,action:{...n,editor:t.editor}})}),t.editor.onChange()}]}},initial:"pristine",states:{pristine:{initial:"idle",states:{idle:{on:{normalizing:{target:"normalizing"},patch:{actions:"defer event",target:"#editor.dirty"},mutation:{actions:"defer event",target:"#editor.dirty"}}},normalizing:{on:{"done normalizing":{target:"idle"},patch:{actions:"defer event"},mutation:{actions:"defer event"}}}}},dirty:{entry:["emit pending events","clear pending events"],on:{patch:{actions:"emit patch event"},mutation:{actions:"emit mutation event"}}}}}),tK=(0,a.createContext)(null),tZ=()=>{let e=(0,a.useContext)(tK);if(void 0===e)throw Error("The `usePortableTextEditorSelection` hook must be used inside the <PortableTextEditor> component's context.");return e},tX=O("component:PortableTextEditor:SelectionProvider"),tQ=tX.enabled&&!1;function t0(e){let t,n,i;let r=(0,p.c)(6),[o,s]=(0,a.useState)(null);return r[0]!==e.editorActor?(t=()=>{tX("Subscribing to selection changes");let t=e.editorActor.on("selection",e=>{(0,a.startTransition)(()=>{tQ&&tX("Setting selection"),s(e.selection)})});return()=>{tX("Unsubscribing to selection changes"),t.unsubscribe()}},n=[e.editorActor],r[0]=e.editorActor,r[1]=t,r[2]=n):(t=r[1],n=r[2]),(0,a.useEffect)(t,n),r[3]!==o||r[4]!==e.children?(i=(0,l.jsx)(tK.Provider,{value:o,children:e.children}),r[3]=o,r[4]=e.children,r[5]=i):i=r[5],i}let t1=()=>(0,L.E2)(12),t2=O("component:PortableTextEditor");class t3 extends a.Component{static displayName="PortableTextEditor";change$=new g.x;constructor(e){if(super(e),e.editor)this.editorActor=e.editor,this.editorActor.start(),this.schemaTypes=this.editorActor.getSnapshot().context.schema;else{if(!e.schemaType)throw Error('PortableTextEditor: missing "schemaType" property');e.incomingPatches$&&console.warn("The prop 'incomingPatches$' is deprecated and renamed to 'patches$'"),this.schemaTypes=Y(e.schemaType.hasOwnProperty("jsonType")?e.schemaType:eb(e.schemaType)),this.editorActor=e.editor??(0,b.A)(tq,{input:{keyGenerator:e.keyGenerator||t1,schema:this.schemaTypes}}),this.editorActor.start()}}componentDidUpdate(e){this.props.editor||e.editor||this.props.schemaType===e.schemaType||(this.schemaTypes=Y(this.props.schemaType.hasOwnProperty("jsonType")?this.props.schemaType:eb(this.props.schemaType)),this.editorActor.send({type:"update schema",schema:this.schemaTypes})),this.props.editorRef!==e.editorRef&&this.props.editorRef&&(this.props.editorRef.current=this)}setEditable=e=>{this.editable={...this.editable,...e}};getValue=()=>{if(this.editable)return this.editable.getValue()};render(){let e=this.props.editor||typeof this.props.maxBlocks>"u"?void 0:Number.parseInt(this.props.maxBlocks.toString(),10)||void 0,t=!!this.props.readOnly,n=this.props.editor?void 0:this.props.incomingPatches$??this.props.patches$;return(0,l.jsxs)(l.Fragment,{children:[n?(0,l.jsx)(t8,{editorActor:this.editorActor,patches$:n}):null,(0,l.jsx)(tG.Provider,{value:this.editorActor,children:(0,l.jsx)(tP,{editorActor:this.editorActor,maxBlocks:e,portableTextEditor:this,readOnly:t,children:(0,l.jsx)(ey.Provider,{value:this,children:(0,l.jsx)(tI.Provider,{value:t,children:(0,l.jsxs)(t0,{editorActor:this.editorActor,children:[(0,l.jsx)(tW,{editorActor:this.editorActor,getValue:this.getValue,onChange:e=>{this.props.editor||this.props.onChange(e),this.change$.next(e)},value:this.props.value}),this.props.children]})})})})})]})}static activeAnnotations=e=>e&&e.editable?e.editable.activeAnnotations():[];static isAnnotationActive=(e,t)=>!!e&&!!e.editable&&e.editable.isAnnotationActive(t);static addAnnotation=(e,t,n)=>e.editable?.addAnnotation(t,n);static blur=e=>{t2("Host blurred"),e.editable?.blur()};static delete=(e,t,n)=>e.editable?.delete(t,n);static findDOMNode=(e,t)=>e.editable?.findDOMNode(t);static findByPath=(e,t)=>e.editable?.findByPath(t)||[];static focus=e=>{t2("Host requesting focus"),e.editable?.focus()};static focusBlock=e=>e.editable?.focusBlock();static focusChild=e=>e.editable?.focusChild();static getSelection=e=>e.editable?e.editable.getSelection():null;static getValue=e=>e.editable?.getValue();static hasBlockStyle=(e,t)=>e.editable?.hasBlockStyle(t);static hasListStyle=(e,t)=>e.editable?.hasListStyle(t);static isCollapsedSelection=e=>e.editable?.isCollapsedSelection();static isExpandedSelection=e=>e.editable?.isExpandedSelection();static isMarkActive=(e,t)=>e.editable?.isMarkActive(t);static insertChild=(e,t,n)=>(t2("Host inserting child"),e.editable?.insertChild(t,n));static insertBlock=(e,t,n)=>e.editable?.insertBlock(t,n);static insertBreak=e=>e.editable?.insertBreak();static isVoid=(e,t)=>e.editable?.isVoid(t);static isObjectPath=(e,t)=>{if(!t||!Array.isArray(t))return!1;let n=t.length>3&&"children"===t[1];return t.length>1&&"children"!==t[1]||n};static marks=e=>e.editable?.marks();static select=(e,t)=>{t2("Host setting selection",t),e.editable?.select(t)};static removeAnnotation=(e,t)=>e.editable?.removeAnnotation(t);static toggleBlockStyle=(e,t)=>(t2("Host is toggling block style"),e.editable?.toggleBlockStyle(t));static toggleList=(e,t)=>e.editable?.toggleList(t);static toggleMark=(e,t)=>{t2("Host toggling mark",t),e.editable?.toggleMark(t)};static getFragment=e=>(t2("Host getting fragment"),e.editable?.getFragment());static undo=e=>{t2("Host undoing"),e.editable?.undo()};static redo=e=>{t2("Host redoing"),e.editable?.redo()};static isSelectionsOverlapping=(e,t,n)=>e.editable?.isSelectionsOverlapping(t,n)}function t8(e){let t,n;let i=(0,p.c)(4);return i[0]!==e.patches$||i[1]!==e.editorActor?(t=()=>{let t=e.patches$.subscribe(t=>{e.editorActor.send({type:"patches",...t})});return()=>{t.unsubscribe()}},n=[e.editorActor,e.patches$],i[0]=e.patches$,i[1]=e.editorActor,i[2]=t,i[3]=n):(t=i[2],n=i[3]),(0,a.useEffect)(t,n),null}let t4=O("components:Leaf"),t6=[],t5=e=>{let{editorActor:t,attributes:n,children:i,leaf:r,schemaTypes:s,renderChild:d,renderDecorator:p,renderAnnotation:u}=e,g=(0,a.useRef)(null),y=em(),m=(0,h.vt)(),[k,b]=(0,a.useState)(!1),[v,x]=(0,a.useState)(!1),_=i.props.parent,N=(0,a.useMemo)(()=>_?[{_key:_?._key},"children",{_key:r._key}]:[],[_,r._key]),w=(0,a.useMemo)(()=>s.decorators.map(e=>e.value),[s.decorators]),T=(0,a.useMemo)(()=>f((r.marks||t6).filter(e=>w.includes(e))),[w,r.marks]),S=Array.isArray(r.marks)?r.marks:t6,E=(0,a.useMemo)(()=>S.map(e=>!w.includes(e)&&_?.markDefs?.find(t=>t._key===e)).filter(Boolean),[S,_,w]),M=E.length>0&&m;(0,a.useEffect)(()=>{if(!M){b(!1);return}let e=t3.getSelection(y);e&&o(e.focus.path,N)&&t3.isCollapsedSelection(y)&&(0,a.startTransition)(()=>{b(!0)})},[M,N,y]);let A=(0,a.useCallback)(()=>{if(!M)return;t4("Setting selection and focus from range");let e=window.getSelection();if(!e){x(!1);return}if(e&&e.rangeCount>0){let t=e.getRangeAt(0);g.current&&t.intersectsNode(g.current)?x(!0):x(!1)}else x(!1)},[M]);(0,a.useEffect)(()=>{if(!M)return;let e=t.on("blur",()=>{b(!1),x(!1)}),n=t.on("focus",()=>{let e=t3.getSelection(y);e&&o(e.focus.path,N)&&t3.isCollapsedSelection(y)&&b(!0),A()}),i=t.on("selection",e=>{e.selection&&o(e.selection.focus.path,N)&&t3.isCollapsedSelection(y)?b(!0):b(!1),A()});return()=>{e.unsubscribe(),n.unsubscribe(),i.unsubscribe()}},[t,N,y,A,M]),(0,a.useEffect)(()=>A(),[A]);let R=(0,a.useMemo)(()=>{let e=i;if(c.xv.isText(r)&&r._type===s.span.name&&(T.forEach(t=>{let n=s.decorators.find(e=>e.value===t);n&&p&&(e=p(Object.defineProperty({children:e,editorElementRef:g,focused:k,path:N,selected:v,schemaType:n,value:t},"type",{enumerable:!1,get:()=>(console.warn("Property 'type' is deprecated, use 'schemaType' instead."),n)})))}),_&&E.length>0&&E.forEach(t=>{let n=s.annotations.find(e=>e.name===t._type);if(n){if(u){let i=Object.defineProperty({block:_,children:e,editorElementRef:g,focused:k,path:N,selected:v,schemaType:n,value:t},"type",{enumerable:!1,get:()=>(console.warn("Property 'type' is deprecated, use 'schemaType' instead."),n)});e=(0,l.jsx)("span",{ref:g,children:u(i)})}else e=(0,l.jsx)(ek,{annotation:t,children:(0,l.jsx)("span",{ref:g,children:e})})}}),_&&d)){let t=_.children.find(e=>e._key===r._key);t&&(e=d(Object.defineProperty({annotations:E,children:(0,l.jsx)(l.Fragment,{children:e}),editorElementRef:g,focused:k,path:N,schemaType:s.span,selected:v,value:t},"type",{enumerable:!1,get:()=>(console.warn("Property 'type' is deprecated, use 'schemaType' instead."),s.span)})))}return e},[E,_,i,k,r,T,N,u,d,p,s.annotations,s.decorators,s.span,v]);return(0,a.useMemo)(()=>(0,l.jsx)("span",{...n,ref:g,children:R},r._key),[r,n,R])};t5.displayName="Leaf";let t9=O("component:Editable"),t7={position:"absolute",userSelect:"none",pointerEvents:"none",left:0,right:0},ne=(0,a.forwardRef)(function(e,t){let{hotkeys:n,onBlur:r,onFocus:d,onBeforeInput:p,onPaste:u,onCopy:f,onClick:g,rangeDecorations:y,renderAnnotation:m,renderBlock:k,renderChild:b,renderDecorator:v,renderListItem:x,renderPlaceholder:_,renderStyle:N,selection:w,scrollSelectionIntoView:E,spellCheck:M,...A}=e,R=em(),L=tY(),C=(0,a.useRef)(null),[B,D]=(0,a.useState)(null),[$,P]=(0,a.useState)(!1),[I,Y]=(0,a.useState)([]);(0,a.useImperativeHandle)(t,()=>C.current);let j=(0,a.useRef)(y),O=(0,a.useContext)(tG),{schemaTypes:z}=R,F=(0,h.ui)(),V=z.block.name,H=(0,a.useMemo)(()=>function(e){let t=z.block.name,n=z.span.name,i=z.block.options.unstable_whitespaceOnPasteMode,r=t=>t.map(t=>e.isTextBlock(t)?t.children.map(e=>e._type===n?e.text:`[${z.inlineObjects.find(t=>t.name===e._type)?.title||"Object"}]`).join(""):`[${z.blockObjects.find(e=>e.name===t._type)?.title||"Object"}]`).join(`

`);return e.setFragmentData=(n,i)=>{let{selection:l}=e;if(!l)return;let[o,s]=c.e6.edges(l),a=c.ML.void(e,{at:o.path}),d=c.ML.void(e,{at:s.path});if(c.e6.isCollapsed(l)&&!a)return;let p=h.F3.toDOMRange(e,l),u=p.cloneContents();if(d){let[t]=d,n=p.cloneRange(),i=h.F3.toDOMNode(e,t);n.setEndAfter(i),u=n.cloneContents()}Array.from(u.querySelectorAll("[data-slate-zero-width]")).forEach(e=>{let t="n"===e.getAttribute("data-slate-zero-width");e.textContent=t?`
`:""}),Array.from(u.querySelectorAll("*")).forEach(e=>{for(let t in e.removeAttribute("contentEditable"),e.removeAttribute("data-slate-inline"),e.removeAttribute("data-slate-leaf"),e.removeAttribute("data-slate-node"),e.removeAttribute("data-slate-spacer"),e.removeAttribute("data-slate-string"),e.removeAttribute("data-slate-zero-width"),e.removeAttribute("draggable"),e.attributes)e.hasAttribute(t)&&e.removeAttribute(t)});let f=u.ownerDocument.createElement("div");f.appendChild(u),f.setAttribute("hidden","true"),u.ownerDocument.body.appendChild(f);let g=f.innerHTML;u.ownerDocument.body.removeChild(f);let y=q(e.getFragment(),t),m=JSON.stringify(y),k=r(y);n.clearData(),n.setData("text/plain",k),n.setData("text/html",g),n.setData("application/json",m),n.setData("application/x-portable-text",m),tR("text",k),n.setData("application/x-portable-text-event-origin",i||"external"),tR("Set fragment data",m,g)},e.insertPortableTextData=t=>{if(!e.selection)return!1;let i=t.getData("application/x-portable-text"),r=t.getData("application/x-portable-text-event-origin");if(tR(`Inserting portable text from ${r} event`,i),i){let t=JSON.parse(i);if(Array.isArray(t)&&t.length>0){var l,o;let i=(l=U(t,{schemaTypes:z}),o=O.getSnapshot().context.keyGenerator,l.map(t=>{let i={...t};if(e.isTextBlock(i)){let t=z.annotations.map(e=>e.name);if(0===t.length){let{markDefs:e,...t}=i;return{...t,_key:o()}}if((i.markDefs||[]).some(e=>!t.includes(e._type))){let e=(i.markDefs||[]).filter(e=>t.includes(e._type));return{...i,markDefs:e,_key:o()}}i.markDefs=(i.markDefs||[]).map(t=>{let r=t._key,l=o();return i.children=i.children.map(t=>t._type===n&&e.isTextSpan(t)?{...t,marks:t.marks&&t.marks.includes(r)?[...t.marks].filter(e=>e!==r).concat(l):t.marks}:t),{...t,_key:l}})}let r={...i,_key:o()};return e.isTextBlock(r)&&(r.children=r.children.map(e=>({...e,_key:o()}))),r})),r=tA(t,z,O.getSnapshot().context.keyGenerator);if(!r.valid&&!r.resolution?.autoResolve){let e=`${r.resolution?.description}`;return O.send({type:"error",name:"pasteError",description:e,data:r}),tR("Invalid insert result",r),!1}return tC(e,i,z),!0}}return!1},e.insertTextOrHTMLData=n=>{if(!e.selection)return tR("No selection, not inserting"),!1;let r=n.getData("text/html"),l=n.getData("text/plain");if(r||l){let o,s,a;if(tR("Inserting data",n),r){if(s=U(o=(0,S.zW)(r,z.portableText,{unstable_whitespaceOnPasteMode:i}).map(e=>(0,S.nX)(e,{blockTypeName:t})),{schemaTypes:z}),a="HTML",0===o.length)return!1}else{let e=`<html><body>${String(l).replace(/[&<>"'`=/]/g,e=>tL[e]).split(/\n{2,}/).map(e=>e?`<p>${e.replace(/(?:\r\n|\r|\n)/g,"<br/>")}</p>`:"<p></p>").join("")}</body></html>`;s=U(o=(0,S.zW)(e,z.portableText).map(e=>(0,S.nX)(e,{blockTypeName:t})),{schemaTypes:z}),a="text"}let c=tA(o,z,O.getSnapshot().context.keyGenerator);if(!c.valid){let e=`Could not validate the resulting portable text to insert.
${c.resolution?.description}
Try to insert as plain text (shift-paste) instead.`;return O.send({type:"error",name:"pasteError",description:e,data:c}),tR("Invalid insert result",c),!1}return tR(`Inserting ${a} fragment at ${JSON.stringify(e.selection)}`),tC(e,s,z),!0}return!1},e.insertData=t=>{e.insertPortableTextData(t)||e.insertTextOrHTMLData(t)},e.insertFragmentData=t=>{let n=t.getData("application/x-portable-text");if(n){let t=JSON.parse(n);return e.insertFragment(t),!0}return!1},e},[O,z]),Z=(0,a.useMemo)(()=>(function(e,t){let n=["enter","tab","shift","delete","end"],r=t||tM;return function(t){return t.pteWithHotKeys=l=>{Object.keys(r).forEach(i=>{if("marks"===i)for(let e in r[i]){if(n.includes(e))throw Error(`The hotkey ${e} is reserved!`);if((0,T.P6)(e,l.nativeEvent)){l.preventDefault();let n=r[i];if(n){let i=n[e];tE(`HotKey ${e} to toggle ${i}`),t.pteToggleMark(i)}}}if("custom"===i)for(let t in r[i]){if(n.includes(t))throw Error(`The hotkey ${t} is reserved!`);if((0,T.P6)(t,l.nativeEvent)){let n=r[i];n&&(0,n[t])(l,e)}}});let o=(0,T.P6)("enter",l.nativeEvent),s=(0,T.P6)("tab",l.nativeEvent),a=(0,T.P6)("shift+enter",l.nativeEvent),h=(0,T.P6)("shift+tab",l.nativeEvent),d=(0,T.P6)("down",l.nativeEvent),p=(0,T.P6)("up",l.nativeEvent);if(d&&t.selection){let e=c.NB.descendant(t,t.selection.focus.path.slice(0,1));if(e&&c.ML.isVoid(t,e)){let e=c.y$.next(t.selection.focus.path.slice(0,1));if(!c.NB.has(t,e)){c.YR.insertNodes(t,t.pteCreateTextBlock({decorators:[]}),{at:e}),c.YR.select(t,{path:[...e,0],offset:0}),t.onChange();return}}}if(p&&t.selection){let e=0===t.selection.focus.path[0],n=c.NB.descendant(t,t.selection.focus.path.slice(0,1));if(e&&n&&c.ML.isVoid(t,n)){c.YR.insertNodes(t,t.pteCreateTextBlock({decorators:[]}),{at:[0]}),c.YR.select(t,{path:[0,0],offset:0}),t.onChange();return}}if((s||h)&&t.selection){let[e]=c.ML.node(t,t.selection.focus,{depth:2}),[n]=(0,i.NG)(e)?c.ML.node(t,t.selection.focus,{depth:1}):[],r=e&&(0,i.DG)(n)&&(0,i.NG)(e)&&(e.marks||[]).filter(e=>(n.markDefs||[]).map(e=>e._key).includes(e)).length>0,[o]=c.e6.edges(t.selection),s=c.ML.isStart(t,o,o.path);e&&(0,i.NG)(e)&&(!r||s)&&t.pteIncrementBlockLevels(h)&&l.preventDefault()}if(o&&!a&&t.selection){let e=t.selection.focus.path.slice(0,1),n=c.NB.descendant(t,e);if(t.isListBlock(n)){t.pteEndList()&&l.preventDefault();return}}},t}})(R,n),[n,R]);(0,a.useMemo)(()=>L?(t9("Editable is in read only mode"),H(F)):(t9("Editable is in edit mode"),H(Z(F))),[L,F,Z,H]);let X=(0,a.useCallback)(e=>(0,l.jsx)(eg,{...e,readOnly:L,renderBlock:k,renderChild:b,renderListItem:x,renderStyle:N,schemaTypes:z,spellCheck:M}),[z,M,L,k,b,x,N]),Q=(0,a.useCallback)(e=>{if("span"===e.leaf._type){let t=(0,l.jsx)(t5,{...e,editorActor:O,schemaTypes:z,renderAnnotation:m,renderChild:b,renderDecorator:v,readOnly:L});if(_&&e.leaf.placeholder&&""===e.text.text)return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("span",{style:t7,contentEditable:!1,children:_()}),t]});let n=e.leaf.rangeDecoration;return n&&(t=n.component({children:t})),t}return e.children},[O,L,m,b,v,_,z]),ee=(0,a.useCallback)(()=>{if(w){t9(`Selection from props ${JSON.stringify(w)}`);let e=function(e,t){if(!e||!t||0===t.length)return null;let n=null,i=null,{anchor:r,focus:l}=e;return r&&t.find(e=>o({_key:e._key},r.path[0]))&&(n=J(r,t)),l&&t.find(e=>o({_key:e._key},l.path[0]))&&(i=J(l,t)),n&&i?{anchor:n,focus:i,backward:e.backward}:null}(w,q(F.children,V));if(null!==e){t9(`Normalized selection from props ${JSON.stringify(e)}`);let t=G(e,F);t&&(c.YR.select(F,t),F.operations.some(e=>"set_selection"===e.type)||O.send({type:"selection",selection:e}),F.onChange())}}},[V,O,w,F]),et=(0,a.useCallback)(e=>{if(y&&y.length>0){let t=[];if(y.forEach(n=>{let i;let r=G(n.selection,F);if(!c.e6.isRange(r)){n.onMoved&&n.onMoved({newSelection:null,rangeDecoration:n,origin:"local"});return}if(e&&((i=function(e,t){let n=c.E9.transform(e.anchor,t),i=c.E9.transform(e.focus,t);return null===n||null===i?null:c.E9.equals(n,e.anchor)&&c.E9.equals(i,e.focus)?e:{anchor:n,focus:i}}(r,e))&&i!==r||null===i&&r)){let e=W(t3.getValue(R),i,z);n.onMoved&&n.onMoved({newSelection:e,rangeDecoration:n,origin:"local"})}null!==i&&t.push({...i||r,rangeDecoration:n})}),t.length>0){Y(t);return}}Y(e=>e.length>0?[]:e)},[R,y,z,F]);(0,a.useEffect)(()=>{let e=O.on("ready",()=>{ee()}),t=O.on("invalid value",()=>{P(!0)}),n=O.on("value changed",()=>{P(!1)});return()=>{e.unsubscribe(),t.unsubscribe(),n.unsubscribe()}},[O,ee]),(0,a.useEffect)(()=>{w&&!$&&ee()},[$,w,ee]);let en=(0,a.useMemo)(()=>F.apply,[F]),[ei,er]=(0,a.useState)(!1);(0,a.useEffect)(()=>{ei||(er(!0),et())},[et,ei]),(0,a.useEffect)(()=>{o(y,j.current)||et(),j.current=y},[y,et]),(0,a.useEffect)(()=>(F.apply=e=>{en(e),"set_selection"!==e.type&&et(e)},()=>{F.apply=en}),[en,F,et]);let el=(0,a.useCallback)(e=>{f&&void 0!==f(e)&&e.preventDefault()},[f]),eo=(0,a.useCallback)(e=>{if(e.preventDefault(),!F.selection)return;if(!u){t9("Pasting normally"),F.insertData(e.clipboardData);return}let t=t3.getValue(R),n=W(t,F.selection,z)?.focus.path||[],i=u({event:e,value:t,path:n,schemaTypes:z});void 0===i?(t9("No result from custom paste handler, pasting normally"),F.insertData(e.clipboardData)):(O.send({type:"loading"}),Promise.resolve(i).then(t=>{t9("Custom paste function from client resolved",t),t&&t.insert?t.insert?F.insertFragment(U(t.insert,{schemaTypes:z})):console.warn("Your onPaste function returned something unexpected:",t):(t9("No result from custom paste handler, pasting normally"),F.insertData(e.clipboardData))}).catch(e=>(console.error(e),e)).finally(()=>{O.send({type:"done loading"})}))},[O,u,R,z,F]),es=(0,a.useCallback)(e=>{if(d&&d(e),!e.isDefaultPrevented()){let t=t3.getSelection(R);null===t&&(c.YR.select(F,c.ML.start(F,[])),F.onChange()),O.send({type:"focus",event:e}),t===t3.getSelection(R)&&O.send({type:"selection",selection:t})}},[O,d,R,F]),ea=(0,a.useCallback)(e=>{if(g&&g(e),F.selection&&e.target===e.currentTarget){let[e,t]=c.NB.last(F,[]),n=F.selection.focus.path.slice(0,1),i=t.slice(0,1);if(c.y$.equals(n,i)){let n=c.NB.descendant(F,t.slice(0,1));e&&c.ML.isVoid(F,n)&&(c.YR.insertNodes(F,F.pteCreateTextBlock({decorators:[]})),F.onChange())}}},[g,F]),ec=(0,a.useCallback)(e=>{r&&r(e),e.isPropagationStopped()||O.send({type:"blur",event:e})},[O,r]),eh=(0,a.useCallback)(e=>{p&&p(e)},[p]),ed=(0,a.useCallback)(()=>{if(!F.selection)return;let{activeElement:e}=h.F3.findDocumentOrShadowRoot(F);if(C.current!==e)return;let t=h.F3.getWindow(F).getSelection();if(!t||0===t.rangeCount)return;let n=t.getRangeAt(0);try{let e=h.F3.toDOMRange(F,F.selection);(e.startOffset!==n.startOffset||e.endOffset!==n.endOffset)&&(t9("DOM range out of sync, validating selection"),t?.removeAllRanges(),t.addRange(e))}catch{t9("Could not resolve selection, selecting top document"),c.YR.deselect(F),F.children.length>0&&c.YR.select(F,[0,0]),F.onChange()}},[C,F]);(0,a.useEffect)(()=>{if(B){let e=new MutationObserver(ed);return e.observe(B,{attributeOldValue:!1,attributes:!1,characterData:!1,childList:!0,subtree:!0}),()=>{e.disconnect()}}},[ed,B]);let ep=(0,a.useCallback)(t=>{e.onKeyDown&&e.onKeyDown(t),t.isDefaultPrevented()||F.pteWithHotKeys(t)},[e,F]),eu=(0,a.useMemo)(()=>{if(void 0!==E)return null===E?s:(e,t)=>{E(R,t)}},[R,E]),ef=(0,a.useCallback)(([,e])=>{if(K(F.children,z))return[{anchor:{path:[0,0],offset:0},focus:{path:[0,0],offset:0},placeholder:!0}];if(0===e.length)return[];let t=I.filter(t=>c.e6.isCollapsed(t)?2===e.length&&c.y$.equals(t.focus.path,e)&&c.y$.equals(t.anchor.path,e):c.e6.intersection(t,{anchor:{path:e,offset:0},focus:{path:e,offset:0}})||c.e6.includes(t,e));return t.length>0?t:[]},[F,z,I]);return(0,a.useEffect)(()=>{C.current=h.F3.toDOMNode(F,F),D(C.current)},[F,C]),R?$?null:(0,l.jsx)(h.CX,{...A,autoFocus:!1,className:A.className||"pt-editable",decorate:ef,onBlur:ec,onCopy:el,onClick:ea,onDOMBeforeInput:eh,onFocus:es,onKeyDown:ep,onPaste:eo,readOnly:L,renderPlaceholder:void 0,renderElement:X,renderLeaf:Q,scrollSelectionIntoView:eu}):null});ne.displayName="ForwardRef(PortableTextEditable)"}}]);